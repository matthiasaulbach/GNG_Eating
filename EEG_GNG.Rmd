---
title: "EEG GNG"
output:
  html_document:
    code_folding: hide
    number_sections: yes
    df_print: paged
    toc: yes
    toc_float: true
  pdf_document:
    number_sections: yes
    toc: yes
---

```{r setup, include=FALSE, error=FALSE, warning=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE, error=FALSE, warning=FALSE)
pacman::p_load(tidyverse, rprime, wrapr, ggplot2, xlsx, here, lmerTest, afex)
options(scipen=999)
test_dats_raw <- readRDS("E-Prime data/raw_RT_data.rds")
```


```{r outlier removal, echo=FALSE}
test_dats_trim <- test_dats_raw %>% 
  select(-c(2:15), -BMI) %>%
  subset(!is.na(Stim.RT))
test_dats_trim$Subject <- as.numeric(test_dats_trim$Subject)
test_dats_trim$Running <- as.factor(test_dats_trim$Running)

test_dats_trim$accuracy <- ifelse(test_dats_trim$commission == 1 | 
                                          test_dats_trim$ommission == 1, 0, 1)


# Converting test_dats_trim to a data.frame object since sdTrim apparently can only handle that class of object

test_dats_trim <- as.data.frame(test_dats_trim)

# This removes outliers per condition, i.e. within balanced, HighCalGo, and LowCalGo blocks, respectively
## It ALSO removes error trials since I included minRT = 150 (and error trials have "0" reaction time). 
## Note that "minRT" removes the RTs below the threshold BEFORE doing the SD trimming.
test_dats <- trimr::sdTrim(data = subset(test_dats_trim, 
                                  (test_dats_trim$GOorNO == "GO") & 
                                    (!is.na(test_dats_trim$Stim.RT)) & 
                                    (Running == "TrialListTestBalanced" |
                                       Running == "TrialListHighCalGo" |
                                       Running == "TrialListLowCalGo")), condVar = "Running", pptVar = "Subject", rtVar = "Stim.RT",
                              perCondition = TRUE, perParticipant = TRUE,
                               minRT = 150, sd = 3, returnType = "raw", digits = 0)

## Note that "test_dats" now holds GO trials only!
```


```{r, echo=FALSE}
## RT grouped by Subject, Primetype, Block (Assessment, HighCalGo, LowCalGo), and Cycle
RT_by_subject <- subset(test_dats, (Primetype == "HighGo" | Primetype == "LowGo")) %>% 
  filter(!is.na(Stim.RT)) %>% 
  filter(Running != "TrialListTrain") %>%
  group_by(Subject, Primetype, Running, Cycle) %>%
  dplyr::summarize(meanRT = mean(Stim.RT, na.rm = TRUE), sdRT = sd(Stim.RT, na.rm = TRUE))
## Let's make RT_by_subject tidy
RT_tidy <- RT_by_subject %>%
  select(-sdRT) %>%
  unite(Prime_Running, Primetype, Running) %>%
  unite(Prime_Running_Cycle, Prime_Running, Cycle) %>%
  spread(key = Prime_Running_Cycle, value = meanRT)
## Need to put age etc. back into the dataframe
RT_tidy$Age <- as.numeric(subset(test_dats_raw$Age, !is.na(test_dats_raw$Age)))
RT_tidy$Sex <- subset(test_dats_raw$Sex, !is.na(test_dats_raw$Sex))
RT_tidy$Handedness <- subset(test_dats_raw$Handedness, !is.na(test_dats_raw$Handedness))
RT_tidy$Height <- subset(test_dats_raw$Height, !is.na(test_dats_raw$Height))
RT_tidy$Weight <- subset(test_dats_raw$Weight, !is.na(test_dats_raw$Weight))
RT_tidy$BMI <- subset(test_dats_raw$BMI, !is.na(test_dats_raw$BMI))
```

```{r, echo=FALSE}
# Out of curiosity, we can check the evaluations of different food items
food_evals <- test_dats_raw %>% 
  filter(!is.na(FoodEvalItems.RESP)) %>%
  group_by(FoodPic) %>%
  summarize(mean = mean(FoodEvalItems.RESP), sd = sd(FoodEvalItems.RESP))
```

```{r data wrangling, echo=FALSE}
###### Read in all the other data
food_hunger_lasteaten <- readRDS("./diaries/food_hunger_lasteaten.rds")
###### And the ERP data:
ERP_tidy <- readRDS("ERP_tidy_individual_averages.rds")

# Creating the baseline difference scores
## since there are two values for each electrode and trial type (the two cycles), I average across those
ERP_tidy <- ERP_tidy %>%
  mutate(BaselineDiff_Cz = 
           (((High_No.1.Balanced.Cz + High_No.2.Balanced.Cz)/2) - ((High_Go.1.Balanced.Cz + High_Go.2.Balanced.Cz)/2)) -
           (((Low_No.1.Balanced.Cz + Low_No.2.Balanced.Cz)/2) - ((Low_Go.1.Balanced.Cz + Low_Go.2.Balanced.Cz)/2)),
         BaselineDiff_FC1 = 
           (((High_No.1.Balanced.FC1 + High_No.2.Balanced.FC1)/2) - ((High_Go.1.Balanced.FC1 + High_Go.2.Balanced.FC1)/2)) -
           (((Low_No.1.Balanced.FC1 + Low_No.2.Balanced.FC1)/2) - ((Low_Go.1.Balanced.FC1 + Low_Go.2.Balanced.FC1)/2)),
         BaselineDiff_FC2 = 
           (((High_No.1.Balanced.FC2 + High_No.2.Balanced.FC2)/2) - ((High_Go.1.Balanced.FC2 + High_Go.2.Balanced.FC2)/2)) -
           (((Low_No.1.Balanced.FC2 + Low_No.2.Balanced.FC2)/2) - ((Low_Go.1.Balanced.FC2 + Low_Go.2.Balanced.FC2)/2)),
         BaselineDiff_Fz = 
           (((High_No.1.Balanced.Fz + High_No.2.Balanced.Fz)/2) - ((High_Go.1.Balanced.Fz + High_Go.2.Balanced.Fz)/2)) -
           (((Low_No.1.Balanced.Fz + Low_No.2.Balanced.Fz)/2) - ((Low_Go.1.Balanced.Fz + Low_Go.2.Balanced.Fz)/2)),
         BaselineDiff_allsites = 
           ((HighNo.Balanced.allsites - HighGo.Balanced.allsites) - (LowNo.Balanced.allsites - LowGo.Balanced.allsites))
  )
```

```{r}
# The final tidy data frame!
diaries_weekdays <- read.table("./diaries/diaries_weekdays.txt", header = TRUE, sep = "\t")
full_dat <- full_join(food_hunger_lasteaten, RT_tidy, by = "Subject")
ERP_tidy$Subject <- as.numeric(ERP_tidy$pp)
full_withERP <- full_join(full_dat, ERP_tidy, by = "Subject")
# adding the "Order" variable
## need to make "Subject" numeric
full_withERP$Subject <- as.numeric(full_withERP$Subject)
full_withERP$Order <- ifelse((full_withERP$Subject %% 2) == 0, "LowHigh", "HighLow")
full_withERP$Subject <- as.factor(full_withERP$Subject)
# Also adding a variable indicating total in-lab food intake
full_withERP$total_in_lab <- full_withERP$consumed_T1 + full_withERP$consumed_T2

# What follows are Reaction Time variables
## Let's rename those columns
full_withERP <- plyr::rename(full_withERP, c("HighGo_TrialListHighCalGo_1"="High_HighGo_1", 
                         "HighGo_TrialListHighCalGo_2"="High_HighGo_2",
                         "HighGo_TrialListHighCalGo_3"="High_HighGo_3",
                         "HighGo_TrialListHighCalGo_4"="High_HighGo_4",
                         "HighGo_TrialListLowCalGo_1"="High_LowGo_1",
                         "HighGo_TrialListLowCalGo_2"="High_LowGo_2",
                         "HighGo_TrialListLowCalGo_3"="High_LowGo_3",
                         "HighGo_TrialListLowCalGo_4"="High_LowGo_4",
                         "HighGo_TrialListTestBalanced_1"="High_Balanced_1",
                         "HighGo_TrialListTestBalanced_2"="High_Balanced_2",
                         "HighGo_TrialListTestBalanced_3"="High_Balanced_3",
                         "HighGo_TrialListTestBalanced_4"="High_Balanced_4",
                         "LowGo_TrialListHighCalGo_1"="Low_HighGo_1", 
                         "LowGo_TrialListHighCalGo_2"="Low_HighGo_2",
                         "LowGo_TrialListHighCalGo_3"="Low_HighGo_3",
                         "LowGo_TrialListHighCalGo_4"="Low_HighGo_4",
                         "LowGo_TrialListLowCalGo_1"="Low_LowGo_1",
                         "LowGo_TrialListLowCalGo_2"="Low_LowGo_2",
                         "LowGo_TrialListLowCalGo_3"="Low_LowGo_3",
                         "LowGo_TrialListLowCalGo_4"="Low_LowGo_4",
                         "LowGo_TrialListTestBalanced_1"="Low_Balanced_1",
                         "LowGo_TrialListTestBalanced_2"="Low_Balanced_2",
                         "LowGo_TrialListTestBalanced_3"="Low_Balanced_3",
                         "LowGo_TrialListTestBalanced_4"="Low_Balanced_4"))

# Creating baseline bias variable
full_withERP$baseline_high_go <- (full_withERP$High_Balanced_1 + full_withERP$High_Balanced_2 +
                                full_withERP$High_Balanced_3 + full_withERP$High_Balanced_4)/4
full_withERP$baseline_low_go <- (full_withERP$Low_Balanced_1 + full_withERP$Low_Balanced_2 +
                                full_withERP$Low_Balanced_3 + full_withERP$Low_Balanced_4)/4
full_withERP$baseline_RTbias <- full_withERP$baseline_high_go - full_withERP$baseline_low_go

# Calculating the training block bias
full_withERP$high_bias_high_go <- (full_withERP$High_HighGo_1 + full_withERP$High_HighGo_2 +
                                full_withERP$High_HighGo_3 + full_withERP$High_HighGo_4)/4
full_withERP$low_bias_low_go <- (full_withERP$Low_LowGo_1 + full_withERP$Low_LowGo_2 +
                                full_withERP$Low_LowGo_3 + full_withERP$Low_LowGo_4)/4
full_withERP$training_RTbias <- full_withERP$high_bias_high_go - full_withERP$low_bias_low_go

# Difference between time points
full_withERP$lab_food_diff <- full_withERP$after_High_Cal_Go - full_withERP$after_Low_Cal_Go

# Creating a mean score for hunger etc.
## Inverting the "full"-item
full_withERP$full_inv <- car::recode(full_withERP$Full.RESP, '1=7; 2=6; 3=5; 4=4; 5=3; 6=2; 7=1')
## taking the mean of all thos variables
full_withERP$overall_hunger <- rowMeans(full_withERP[c("full_inv", "Hungry.RESP" ,"Desire.RESP", "Urge.RESP", "Preoccupation.RESP")], na.rm = TRUE)
```

# Defining outliers
I'll just leave the code here to see so we know how outliers were defined.

```{r outlier participants}
# We have to exclude participant number 12 as that EEG data is not usable
full_withERP <- subset(full_withERP, Subject != 12)
## I can't use the tidy dataframe for detecting outliers. I  need the data to be organised in a different way
ERP_long <- ERP_tidy %>%
  select(., - c("BaselineDiff_Cz":"Subject")) %>%
  mutate(High_No_Balanced_Cz = ((High_No.1.Balanced.Cz + High_No.2.Balanced.Cz)/2),
         High_Go_Balanced_Cz = ((High_Go.1.Balanced.Cz + High_Go.2.Balanced.Cz)/2),
         Low_No_Balanced_Cz = ((Low_No.1.Balanced.Cz + Low_No.2.Balanced.Cz)/2),
         Low_Go_Balanced_Cz = ((Low_Go.1.Balanced.Cz + Low_Go.2.Balanced.Cz)/2),
         High_No_HighCalGo_Cz = ((High_No.1.HighCalGo.Cz + High_No.2.HighCalGo.Cz)/2),
         High_Go_HighCalGo_Cz = ((High_Go.1.HighCalGo.Cz + High_Go.2.HighCalGo.Cz)/2),
         Low_No_HighCalGo_Cz = ((Low_No.1.HighCalGo.Cz + Low_No.2.HighCalGo.Cz)/2),
         Low_Go_HighCalGo_Cz = ((Low_Go.1.HighCalGo.Cz + Low_Go.2.HighCalGo.Cz)/2),
         High_No_LowCalGo_Cz = ((High_No.1.LowCalGo.Cz + High_No.2.LowCalGo.Cz)/2),
         High_Go_LowCalGo_Cz = ((High_Go.1.LowCalGo.Cz + High_Go.2.LowCalGo.Cz)/2),
         Low_No_LowCalGo_Cz = ((Low_No.1.LowCalGo.Cz + Low_No.2.LowCalGo.Cz)/2),
         Low_Go_LowCalGo_Cz = ((Low_Go.1.LowCalGo.Cz + Low_Go.2.LowCalGo.Cz)/2),
         High_No_Balanced_FC1 = ((High_No.1.Balanced.FC1 + High_No.2.Balanced.FC1)/2),
         High_Go_Balanced_FC1 = ((High_Go.1.Balanced.FC1 + High_Go.2.Balanced.FC1)/2),
         Low_No_Balanced_FC1 = ((Low_No.1.Balanced.FC1 + Low_No.2.Balanced.FC1)/2),
         Low_Go_Balanced_FC1 = ((Low_Go.1.Balanced.FC1 + Low_Go.2.Balanced.FC1)/2),
         High_No_HighCalGo_FC1 = ((High_No.1.HighCalGo.FC1 + High_No.2.HighCalGo.FC1)/2),
         High_Go_HighCalGo_FC1 = ((High_Go.1.HighCalGo.FC1 + High_Go.2.HighCalGo.FC1)/2),
         Low_No_HighCalGo_FC1 = ((Low_No.1.HighCalGo.FC1 + Low_No.2.HighCalGo.FC1)/2),
         Low_Go_HighCalGo_FC1 = ((Low_Go.1.HighCalGo.FC1 + Low_Go.2.HighCalGo.FC1)/2),
         High_No_LowCalGo_FC1 = ((High_No.1.LowCalGo.FC1 + High_No.2.LowCalGo.FC1)/2),
         High_Go_LowCalGo_FC1 = ((High_Go.1.LowCalGo.FC1 + High_Go.2.LowCalGo.FC1)/2),
         Low_No_LowCalGo_FC1 = ((Low_No.1.LowCalGo.FC1 + Low_No.2.LowCalGo.FC1)/2),
         Low_Go_LowCalGo_FC1 = ((Low_Go.1.LowCalGo.FC1 + Low_Go.2.LowCalGo.FC1)/2),
         High_No_Balanced_FC2 = ((High_No.1.Balanced.FC2 + High_No.2.Balanced.FC2)/2),
         High_Go_Balanced_FC2 = ((High_Go.1.Balanced.FC2 + High_Go.2.Balanced.FC2)/2),
         Low_No_Balanced_FC2 = ((Low_No.1.Balanced.FC2 + Low_No.2.Balanced.FC2)/2),
         Low_Go_Balanced_FC2 = ((Low_Go.1.Balanced.FC2 + Low_Go.2.Balanced.FC2)/2),
         High_No_HighCalGo_FC2 = ((High_No.1.HighCalGo.FC2 + High_No.2.HighCalGo.FC2)/2),
         High_Go_HighCalGo_FC2 = ((High_Go.1.HighCalGo.FC2 + High_Go.2.HighCalGo.FC2)/2),
         Low_No_HighCalGo_FC2 = ((Low_No.1.HighCalGo.FC2 + Low_No.2.HighCalGo.FC2)/2),
         Low_Go_HighCalGo_FC2 = ((Low_Go.1.HighCalGo.FC2 + Low_Go.2.HighCalGo.FC2)/2),
         High_No_LowCalGo_FC2 = ((High_No.1.LowCalGo.FC2 + High_No.2.LowCalGo.FC2)/2),
         High_Go_LowCalGo_FC2 = ((High_Go.1.LowCalGo.FC2 + High_Go.2.LowCalGo.FC2)/2),
         Low_No_LowCalGo_FC2 = ((Low_No.1.LowCalGo.FC2 + Low_No.2.LowCalGo.FC2)/2),
         Low_Go_LowCalGo_FC2 = ((Low_Go.1.LowCalGo.FC2 + Low_Go.2.LowCalGo.FC2)/2),
         High_No_Balanced_Fz = ((High_No.1.Balanced.Fz + High_No.2.Balanced.Fz)/2),
         High_Go_Balanced_Fz = ((High_Go.1.Balanced.Fz + High_Go.2.Balanced.Fz)/2),
         Low_No_Balanced_Fz = ((Low_No.1.Balanced.Fz + Low_No.2.Balanced.Fz)/2),
         Low_Go_Balanced_Fz = ((Low_Go.1.Balanced.Fz + Low_Go.2.Balanced.Fz)/2),
         High_No_HighCalGo_Fz = ((High_No.1.HighCalGo.Fz + High_No.2.HighCalGo.Fz)/2),
         High_Go_HighCalGo_Fz = ((High_Go.1.HighCalGo.Fz + High_Go.2.HighCalGo.Fz)/2),
         Low_No_HighCalGo_Fz = ((Low_No.1.HighCalGo.Fz + Low_No.2.HighCalGo.Fz)/2),
         Low_Go_HighCalGo_Fz = ((Low_Go.1.HighCalGo.Fz + Low_Go.2.HighCalGo.Fz)/2),
         High_No_LowCalGo_Fz = ((High_No.1.LowCalGo.Fz + High_No.2.LowCalGo.Fz)/2),
         High_Go_LowCalGo_Fz = ((High_Go.1.LowCalGo.Fz + High_Go.2.LowCalGo.Fz)/2),
         Low_No_LowCalGo_Fz = ((Low_No.1.LowCalGo.Fz + Low_No.2.LowCalGo.Fz)/2),
         Low_Go_LowCalGo_Fz = ((Low_Go.1.LowCalGo.Fz + Low_Go.2.LowCalGo.Fz)/2)) %>%
  select(-c(High_Go.1.Balanced.Cz:Low_No.2.LowCalGo.Fz)) %>%
  gather("Variable", "Value", High_No_Balanced_Cz:Low_Go_LowCalGo_Fz) %>%
  separate(Variable, c("HighLow", "GoNo", "Block", "Electrode"))
    
ERP_outlier_det <- ERP_long %>%
  group_by(pp, Block, Electrode) %>%
  summarise_at(vars("Value"), funs(mean)) %>%
  unite(Block_Elec, Block, Electrode, sep = ".") %>%
  spread(key = Block_Elec, value = Value)

full_withERP$ERP_outlier <- ifelse(
      ERP_outlier_det$Balanced.Cz > (mean(ERP_outlier_det$Balanced.Cz) + 3*sd(ERP_outlier_det$Balanced.Cz)) |
      ERP_outlier_det$Balanced.FC1 > (mean(ERP_outlier_det$Balanced.FC1) + 3*sd(ERP_outlier_det$Balanced.FC1)) |
      ERP_outlier_det$Balanced.FC2 > (mean(ERP_outlier_det$Balanced.FC2) + 3*sd(ERP_outlier_det$Balanced.FC2)) |
      ERP_outlier_det$Balanced.Fz > (mean(ERP_outlier_det$Balanced.Fz) + 3*sd(ERP_outlier_det$Balanced.Fz)) |
      ERP_outlier_det$HighCalGo.Cz > (mean(ERP_outlier_det$HighCalGo.Cz) + 3*sd(ERP_outlier_det$HighCalGo.Cz)) |
      ERP_outlier_det$HighCalGo.FC1 > (mean(ERP_outlier_det$HighCalGo.FC1) + 3*sd(ERP_outlier_det$HighCalGo.FC1)) |
      ERP_outlier_det$HighCalGo.FC2 > (mean(ERP_outlier_det$HighCalGo.FC2) + 3*sd(ERP_outlier_det$HighCalGo.FC2)) |
      ERP_outlier_det$HighCalGo.Fz > (mean(ERP_outlier_det$HighCalGo.Fz) + 3*sd(ERP_outlier_det$HighCalGo.Fz)) |
      ERP_outlier_det$LowCalGo.Cz > (mean(ERP_outlier_det$LowCalGo.Cz) + 3*sd(ERP_outlier_det$LowCalGo.Cz)) |
      ERP_outlier_det$LowCalGo.FC1 > (mean(ERP_outlier_det$LowCalGo.FC1) + 3*sd(ERP_outlier_det$LowCalGo.FC1)) |
      ERP_outlier_det$LowCalGo.FC2 > (mean(ERP_outlier_det$LowCalGo.FC2) + 3*sd(ERP_outlier_det$LowCalGo.FC2)) |
      ERP_outlier_det$LowCalGo.Fz > (mean(ERP_outlier_det$LowCalGo.Fz) + 3*sd(ERP_outlier_det$LowCalGo.Fz))
      , 1, 0)


# Outlier participants (defined as 3 sd above or below average)
## Food diary intake
full_withERP$Daily_intake_outlier <- 
  ifelse(full_withERP$Daily_intake > (mean(full_withERP$Daily_intake, na.rm = TRUE) + 3*sd(full_withERP$Daily_intake, na.rm = TRUE)) |
           full_withERP$Daily_intake < (mean(full_withERP$Daily_intake, na.rm = TRUE) - 3*sd(full_withERP$Daily_intake, na.rm = TRUE)),
         1, 0)
## Total lab intake
full_withERP$total_in_lab_outlier <- 
  ifelse(full_withERP$total_in_lab > (mean(full_withERP$total_in_lab) + 3*sd(full_withERP$total_in_lab)) |
           full_withERP$total_in_lab < (mean(full_withERP$total_in_lab) - 3*sd(full_withERP$total_in_lab)),
         1, 0)
## Lab intake difference between timepoints
full_withERP$lab_food_diff_outlier <- 
  ifelse(full_withERP$lab_food_diff > (mean(full_withERP$lab_food_diff) + 3*sd(full_withERP$lab_food_diff)) |
           full_withERP$lab_food_diff < (mean(full_withERP$lab_food_diff) - 3*sd(full_withERP$lab_food_diff)),
         1, 0)
## Baseline bias
full_withERP$baseline_RTbias_outlier <- 
  ifelse(full_withERP$baseline_RTbias > (mean(full_withERP$baseline_RTbias) + 3*sd(full_withERP$baseline_RTbias)) |
           full_withERP$baseline_RTbias < (mean(full_withERP$baseline_RTbias) - 3*sd(full_withERP$baseline_RTbias)),
         1, 0)
## Training bias
full_withERP$training_RTbias_outlier <- 
  ifelse(full_withERP$training_RTbias > (mean(full_withERP$training_RTbias) + 3*sd(full_withERP$training_RTbias)) |
           full_withERP$training_RTbias < (mean(full_withERP$training_RTbias) - 3*sd(full_withERP$training_RTbias)),
         1, 0)
## By average RTs within the different circles within the blocks
full_withERP$RT_outlier <- ifelse(
         full_withERP$High_Balanced_1 > (mean(full_withERP$High_Balanced_1) + 3*sd(full_withERP$High_Balanced_1))|
         full_withERP$High_Balanced_2 > (mean(full_withERP$High_Balanced_2) + 3*sd(full_withERP$High_Balanced_2))|
         full_withERP$High_Balanced_3 > (mean(full_withERP$High_Balanced_3) + 3*sd(full_withERP$High_Balanced_3))|
         full_withERP$High_Balanced_4 > (mean(full_withERP$High_Balanced_4) + 3*sd(full_withERP$High_Balanced_4))|
         full_withERP$Low_Balanced_1 > (mean(full_withERP$Low_Balanced_1) + 3*sd(full_withERP$Low_Balanced_1))|
         full_withERP$Low_Balanced_3 > (mean(full_withERP$Low_Balanced_3) + 3*sd(full_withERP$Low_Balanced_3))|
         full_withERP$Low_Balanced_3 > (mean(full_withERP$Low_Balanced_3) + 3*sd(full_withERP$Low_Balanced_3))|
         full_withERP$Low_Balanced_4 > (mean(full_withERP$Low_Balanced_4) + 3*sd(full_withERP$Low_Balanced_4))|
         full_withERP$High_HighGo_1 > (mean(full_withERP$High_HighGo_1) + 3*sd(full_withERP$High_HighGo_1))|
         full_withERP$High_HighGo_2 > (mean(full_withERP$High_HighGo_2) + 3*sd(full_withERP$High_HighGo_2))|
         full_withERP$High_HighGo_3 > (mean(full_withERP$High_HighGo_3) + 3*sd(full_withERP$High_HighGo_3))|
         full_withERP$High_HighGo_4 > (mean(full_withERP$High_HighGo_4) + 3*sd(full_withERP$High_HighGo_4))|
         full_withERP$Low_HighGo_1 > (mean(full_withERP$Low_HighGo_1) + 3*sd(full_withERP$Low_HighGo_1))|
         full_withERP$Low_HighGo_2 > (mean(full_withERP$Low_HighGo_2) + 3*sd(full_withERP$Low_HighGo_2))|
         full_withERP$Low_HighGo_3 > (mean(full_withERP$Low_HighGo_3) + 3*sd(full_withERP$Low_HighGo_3))|
         full_withERP$Low_HighGo_4 > (mean(full_withERP$Low_HighGo_4) + 3*sd(full_withERP$Low_HighGo_4))|
         full_withERP$High_LowGo_1 > (mean(full_withERP$High_LowGo_1) + 3*sd(full_withERP$High_LowGo_1))|
         full_withERP$High_LowGo_2 > (mean(full_withERP$High_LowGo_2) + 3*sd(full_withERP$High_LowGo_2))|
         full_withERP$High_LowGo_3 > (mean(full_withERP$High_LowGo_3) + 3*sd(full_withERP$High_LowGo_3))|
         full_withERP$High_LowGo_4 > (mean(full_withERP$High_LowGo_4) + 3*sd(full_withERP$High_LowGo_4))|
         full_withERP$Low_LowGo_1 > (mean(full_withERP$Low_LowGo_1) + 3*sd(full_withERP$Low_LowGo_1))|
         full_withERP$Low_LowGo_2 > (mean(full_withERP$Low_LowGo_2) + 3*sd(full_withERP$Low_LowGo_2))|
         full_withERP$Low_LowGo_3 > (mean(full_withERP$Low_LowGo_3) + 3*sd(full_withERP$Low_LowGo_3))|
         full_withERP$Low_LowGo_4 > (mean(full_withERP$Low_LowGo_4) + 3*sd(full_withERP$Low_LowGo_4)), 1, 0)

## Outlier on any of these
full_withERP$outlier <- ifelse(full_withERP$Daily_intake_outlier==1|
                             full_withERP$total_in_lab_outlier==1|
                             full_withERP$lab_food_diff_outlier==1|
                             full_withERP$baseline_RTbias_outlier==1|
                             full_withERP$training_RTbias_outlier==1|
                             full_withERP$RT_outlier==1| 
                             full_withERP$ERP_outlier==1, 1, 0)

## Outlier on any but daily intake (since there are so many to exclude)
full_withERP$outlier_notdaily <- ifelse(full_withERP$total_in_lab_outlier==1|
                             full_withERP$lab_food_diff_outlier==1|
                             full_withERP$baseline_RTbias_outlier==1|
                             full_withERP$training_RTbias_outlier==1|
                             full_withERP$RT_outlier==1|
                             full_withERP$ERP_outlier==1, 1, 0)
ERP_long$outlier <- full_withERP$outlier
ERP_long$outlier_notdaily <- full_withERP$outlier_notdaily
```

Here is the distribution of N2 amplitudes by block. The error bars indicate mean +/- 3sd so we might consider those points outside those limits as outliers (It's messy with the labels but we only need to identify the ones at the extremes anyway).

```{r}
ERP_long_allsites <- ERP_long %>%
  spread(., Electrode, Value) %>%
  rowwise %>%
  mutate(Value = mean(Cz:Fz))
  
ERP_long_summary <- ERP_long_allsites %>% 
  group_by(HighLow, GoNo, Block) %>% 
  summarise_at("Value", funs(mean, sd))
colnames(ERP_long_summary)[colnames(ERP_long_summary) == "mean"] <- "Value"

ggplot(ERP_long_allsites, aes(x = HighLow, y = Value, color = GoNo)) + 
  geom_point(alpha = .3, position = position_jitter(width = 0.2, height = 0)) +
  facet_wrap(facets = "Block") + 
  geom_point(data = ERP_long_summary, stat = "identity", size = 5, alpha = 1) + 
  geom_errorbar(data = ERP_long_summary, aes(ymin = (Value-3*sd), ymax = (Value+3*sd)), width = 0.3) +
  geom_text(aes(label = pp))
```

Looks like no participant is outside the +/- 3 sd range.

# Graphs

Just some graphs and stuff to get an idea about the behavioral data.

Errors by Subject and session (Baseline vs HighCalGo vs LowCalGo). Blue dots are ommission errors, red dots commission errors.

```{r, echo=FALSE}
error_plot <- test_dats_raw %>%
  subset(Running == "TrialListTestBalanced" | Running == "TrialListLowCalGo" | Running == "TrialListHighCalGo") %>%
  group_by(Subject, Running) %>%
  summarise_at(c("commission", "ommission"), sum, na.rm = TRUE)
error_plot_means <- error_plot %>% 
  group_by(Running) %>% 
  summarise(commission = mean(commission), ommission = mean(ommission))
ggplot(data = error_plot, aes(Running, commission)) + 
  geom_point(color = "red") +
  geom_jitter(height = .2, color = "red") +
  geom_point(data = error_plot, aes(Running, ommission), color = "blue") +
  geom_point(data = error_plot_means, stat = "identity", size = 5, alpha = .6)
```

Following are the RTs after trimming outliers by block and by part with larger dots indicating the overall means and the smaller ones the subject mean values.

```{r visualize, echo=FALSE}
### Let's visualize some of this
by_block_cycle <- full_withERP %>%
  select(Subject,
         High_Balanced_1,
         High_Balanced_2,
         High_Balanced_3,
         High_Balanced_4,
         Low_Balanced_1,
         Low_Balanced_2,
         Low_Balanced_3,
         Low_Balanced_4,
         High_HighGo_1,
         High_HighGo_2,
         High_HighGo_3,
         High_HighGo_4,
         Low_HighGo_1,
         Low_HighGo_2,
         Low_HighGo_3,
         Low_HighGo_4,
         High_LowGo_1,
         High_LowGo_2,
         High_LowGo_3,
         High_LowGo_4,
         Low_LowGo_1,
         Low_LowGo_2,
         Low_LowGo_3,
         Low_LowGo_4,
         Order) %>%
  gather(Block, RT, -c(Subject, Order)) %>%
  separate(Block, c("HighLow", "Part", "Cycle"))

by_block_cycle_means <- by_block_cycle %>%
  group_by(HighLow, Part, Cycle) %>%
  summarise(RT = mean(RT))

ggplot(by_block_cycle, aes(x = Cycle, y = RT, color = HighLow)) +
  geom_point(alpha = .3) +
  facet_wrap(aes(facets = Part)) +
  geom_point(data = by_block_cycle_means, stat = "identity", size = 5, alpha = .6) +
  ylim(250, 500)
```

Without the "outlier" participants as defined above:

```{r visualize RTs by parts, echo=FALSE}
### Let's visualize some of this
by_block_cycle_noout <- full_withERP %>%
  select(Subject,
         High_Balanced_1,
         High_Balanced_2,
         High_Balanced_3,
         High_Balanced_4,
         Low_Balanced_1,
         Low_Balanced_2,
         Low_Balanced_3,
         Low_Balanced_4,
         High_HighGo_1,
         High_HighGo_2,
         High_HighGo_3,
         High_HighGo_4,
         Low_HighGo_1,
         Low_HighGo_2,
         Low_HighGo_3,
         Low_HighGo_4,
         High_LowGo_1,
         High_LowGo_2,
         High_LowGo_3,
         High_LowGo_4,
         Low_LowGo_1,
         Low_LowGo_2,
         Low_LowGo_3,
         Low_LowGo_4,
         Order) %>%
  subset(full_withERP$outlier == 0) %>%
  gather(Block, RT, -c(Subject, Order)) %>%
  separate(Block, c("HighLow", "Part", "Cycle"))

by_block_cycle_means_noout <- by_block_cycle_noout %>%
  group_by(HighLow, Part, Cycle) %>%
  summarise(RT = mean(RT))

ggplot(by_block_cycle_noout, aes(x = Cycle, y = RT, color = HighLow)) +
  geom_point(alpha = .3) +
  facet_wrap(aes(facets = Part)) +
  geom_point(data = by_block_cycle_means_noout, stat = "identity", size = 5, alpha = .6) +
  ylim(250, 500)
  
```



# Hypothesis 1: N2 by food image type and Go vs No-Go

So here's the test for the first hypothesis:

```{r}
# Let's test our first hypothesis about the interaction between stimulus type and trial type in the balanced block
aov_car(Value ~ HighLow*GoNo + Error(pp/HighLow*GoNo),
        data=subset(ERP_long, Block == "Balanced"))

# So we have a significant effect of Go/No-Go but no interaction. 

ERP_long_summary_Balanced <- subset(ERP_long, Block == "Balanced") %>% group_by(HighLow, GoNo) %>% summarise_at("Value", funs(mean, sd))
# Looks like Low-calorie No-Go trials provoke the largest N2
ggplot(ERP_long_summary_Balanced, aes(x = HighLow, y = mean, color = GoNo, group = GoNo)) +
  geom_point() + 
  geom_line(stat="identity") +
  geom_errorbar(aes(ymin = mean-2*(sd/nrow(ERP_tidy)), ymax = mean+2*(sd/nrow(ERP_tidy))), inherit = TRUE, width = 0.1)
```

(NB: removing the participants with no and/or reversed GNG effect did not change results)

## Without different outlier criteria:

```{r}
# Without any outliers
aov_car(Value ~ HighLow*GoNo + Error(pp/HighLow*GoNo),
        data=subset(ERP_long, (Block == "Balanced" & outlier == "0")))

# So we have a significant effect of Go/No-Go and of High vs Low but no interaction. 
subset(ERP_long, (Block == "Balanced" & outlier == "0")) %>% group_by(HighLow, GoNo) %>% summarise_at("Value", mean)
# Looks like Low-calorie No-Go trials provoke the largest N2


# Without outliers but with the diary outliers
aov_car(Value ~ HighLow*GoNo + Error(pp/HighLow*GoNo), 
        data=subset(ERP_long, (Block == "Balanced" & outlier_notdaily == "0")))

# So we have a significant effect of Go/No-Go but no other effects
subset(ERP_long, (Block == "Balanced" & outlier_notdaily == "0")) %>% group_by(HighLow, GoNo) %>% summarise_at("Value", mean)
# Looks like Low-calorie No-Go trials provoke the largest N2
```

Regardless of outliers we always find an effect of Go vs No with NoGo trials producing larger N2s (not surprisingly). However, the main effect of food type and the predicted interaction between Go/NoGo and food type are _never_ significant.

# Hypothesis 2: Baseline RT differences

Here's the t-test for baseline differences between High- and Low-calorie foods.

```{r}
# Let's do some inferential statistics
## This is only for the BASELINE block
### paired t-test to compare the different kinds of stimulus
dat_t_test <- NA
dat_t_test$High_Balanced <- (as.numeric(full_withERP$High_Balanced_1) + 
                               as.numeric(full_withERP$High_Balanced_2) +
                               as.numeric(full_withERP$High_Balanced_3) +
                               as.numeric(full_withERP$High_Balanced_4))/4
dat_t_test$Low_Balanced <- (as.numeric(full_withERP$Low_Balanced_1) + 
                              as.numeric(full_withERP$Low_Balanced_2) +
                              as.numeric(full_withERP$Low_Balanced_3) +
                              as.numeric(full_withERP$Low_Balanced_4))/4

t.test(dat_t_test$High_Balanced, dat_t_test$Low_Balanced, paired = TRUE, alternative = "less")
```

There's no difference between the types of food images.  

## Without the "outlier" participants as defined above:

```{r}
# Let's do some inferential statistics
## This is only for the BASELINE block
### paired t-test to compare the different kinds of stimulus
dat_t_test_noout <- NA
dat_t_test_noout$High_Balanced <- subset((as.numeric(full_withERP$High_Balanced_1) + 
                               as.numeric(full_withERP$High_Balanced_2) +
                               as.numeric(full_withERP$High_Balanced_3) +
                               as.numeric(full_withERP$High_Balanced_4)), full_withERP$outlier == 0)/4
dat_t_test_noout$Low_Balanced <- subset((as.numeric(full_withERP$Low_Balanced_1) + 
                              as.numeric(full_withERP$Low_Balanced_2) +
                              as.numeric(full_withERP$Low_Balanced_3) +
                              as.numeric(full_withERP$Low_Balanced_4)), full_withERP$outlier == 0)/4

t.test(dat_t_test_noout$High_Balanced, dat_t_test_noout$Low_Balanced, 
       paired = TRUE, alternative = "less")

## And without the outliers defined without diary intake
dat_t_test_noout2 <- NA
dat_t_test_noout2$High_Balanced <- subset((as.numeric(full_withERP$High_Balanced_1) + 
                               as.numeric(full_withERP$High_Balanced_2) +
                               as.numeric(full_withERP$High_Balanced_3) +
                               as.numeric(full_withERP$High_Balanced_4)), full_withERP$outlier_notdaily == 0)/4
dat_t_test_noout2$Low_Balanced <- subset((as.numeric(full_withERP$Low_Balanced_1) + 
                              as.numeric(full_withERP$Low_Balanced_2) +
                              as.numeric(full_withERP$Low_Balanced_3) +
                              as.numeric(full_withERP$Low_Balanced_4)), full_withERP$outlier_notdaily == 0)/4

t.test(dat_t_test_noout2$High_Balanced, dat_t_test_noout2$Low_Balanced, 
       paired = TRUE, alternative = "less")
```

### Add-on: Food type and cycles

Now we're looking at reaction time differences between High and Low calorie foods and between Cycles.

```{r}
## Testing reaction time differences between High and Low calorie foods and between Cycles
### Getting the data into right format
regression_dat <- full_withERP %>% 
  gather("Trial_Part_Cycle", "RT", 15:38) %>%
  separate(Trial_Part_Cycle, into = c("Trial", "Part", "Cycle"))

fit_baseline_blocks <- lmerTest::lmer(RT ~ Trial*Cycle + (1|Subject),
            data=subset(regression_dat, Part == "Balanced"))

anova_baseline_blocks <- anova(fit_baseline_blocks)
anova_baseline_blocks
summary(fit_baseline_blocks, correlation = FALSE)
## Significant effect of Cycle - contrasts: Participants are faster in Cycle 4 than Cycle 1. 
## No effect of food type and/or interaction.
```

So we see that Cycle 4 is faster than Cycle 1.

And a graph to go with it:

```{r, echo = FALSE}
## Here it is in a graph:
Running_Cycle_balanced <- subset(test_dats, (Primetype == "HighGo" & Running == "TrialListTestBalanced")|(Primetype == "LowGo" & Running == "TrialListTestBalanced")) %>%
  group_by(Cycle, Running, Primetype) %>% 
  summarise(Stim.RT = mean(Stim.RT))

ggplot(data = Running_Cycle_balanced, aes(x = Cycle, y = Stim.RT , color = Primetype)) +
  geom_point(size = 2)
```

#### Without outlier participants:

```{r}
### Testing reaction time differences between High and Low calorie foods and between Cycles
fit_baseline_blocks_noout <- lmerTest::lmer(RT ~ Trial*Cycle + (1|Subject),
            data=subset(regression_dat, Part == "Balanced" & outlier == "0"))

anova_baseline_blocks_noout <- anova(fit_baseline_blocks_noout)
anova_baseline_blocks_noout
summary(fit_baseline_blocks_noout, correlation = FALSE)
## Significant effect of Cycle - contrasts: Participants are faster in Cycle 4 than Cycle 1. 
## No effect of food type and/or interaction.
```


### And then the bias blocks.

```{r}
## Now for the bias blocks
## Comparing reaction times for dominant Go trials from the respective blocks 
## and between Cycles within the respective blocks 

fit_bias_blocks <- lmerTest::lmer(RT ~ Trial*Cycle + (1|Subject),
            data=subset(regression_dat, 
                        (Trial == "High" & Part == "HighGo")|( Trial == "Low" & Part == "LowGo")))
anova_bias_blocks <- anova(fit_bias_blocks)
anova_bias_blocks
summary(fit_bias_blocks, correlation = FALSE)
## There are no significant effects whatsoever

### Visualize much?!
Running_Cycle_bias <- subset(test_dats, 
                             (Primetype == "HighGo" & Running == "TrialListHighCalGo")|(Primetype == "LowGo" & Running == "TrialListLowCalGo")) %>%
  group_by(Cycle, Running, Primetype) %>% 
  summarise(Stim.RT = mean(Stim.RT))

ggplot(data = Running_Cycle_bias, aes(x = Cycle, y = Stim.RT , color = Running, shape = Primetype)) +
  geom_point(size = 2)
```

No significant effects of cycles, food stimuli, or their interaction.

#### And without outlier participants:

```{r}
## Now for the bias blocks
## Comparing reaction times for dominant Go trials from the respective blocks 
## and between Cycles within the respective blocks 

fit_bias_blocks_noout <- lmerTest::lmer(RT ~ Trial*Cycle + (1|Subject),
            data=subset(regression_dat, 
                        (Trial == "High" & Part == "HighGo")|( Trial == "Low" & Part == "LowGo") & 
                          outlier == 0))
anova_bias_blocks_noout <- anova(fit_bias_blocks_noout)
anova_bias_blocks_noout
summary(fit_bias_blocks_noout, correlation = FALSE)
## There are no significant effects whatsoever
```

No significant effects for Cycle in the bias blocks.

# Hypothesis 3: Predicting food intake with N2 differences

To test hypothesis 3: predicting food intake with baseline difference scores: (HighCalorie-NoGo - HighCalorieGo) - (LowCalorie-NoGo - LowCalorieGo).
I always have the model including all participants and then when removing outliers.

```{r}
# For Cz
## Regression for diary intake
summary(lm(Daily_intake ~ BaselineDiff_Cz + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(Daily_intake ~ BaselineDiff_Cz + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
# No effect

## And for lab food intake
summary(lm(total_in_lab ~ BaselineDiff_Cz + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(total_in_lab ~ BaselineDiff_Cz + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
summary(lm(total_in_lab ~ BaselineDiff_Cz + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier_notdaily == "0")))
# No effect

# For FC1
## Regression for diary intake
summary(lm(Daily_intake ~ BaselineDiff_FC1 + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(Daily_intake ~ BaselineDiff_FC1 + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
# No effect

## And for lab food intake
summary(lm(total_in_lab ~ BaselineDiff_FC1 + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(total_in_lab ~ BaselineDiff_FC1 + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
summary(lm(total_in_lab ~ BaselineDiff_FC1 + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier_notdaily == "0")))
# No effect

# For FC2
## Regression for diary intake
summary(lm(Daily_intake ~ BaselineDiff_FC2 + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(Daily_intake ~ BaselineDiff_FC2 + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
# No effect

## And for lab food intake
summary(lm(total_in_lab ~ BaselineDiff_FC2 + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(total_in_lab ~ BaselineDiff_FC2 + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
summary(lm(total_in_lab ~ BaselineDiff_FC2 + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier_notdaily == "0")))
# No effect

# For Fz
## Regression for diary intake
summary(lm(Daily_intake ~ BaselineDiff_Fz + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(Daily_intake ~ BaselineDiff_Fz + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
# No effect

## And for lab food intake
summary(lm(total_in_lab ~ BaselineDiff_Fz + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(total_in_lab ~ BaselineDiff_Fz + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
summary(lm(total_in_lab ~ BaselineDiff_Fz + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier_notdaily == "0")))
# No effect

## And, last but not least, for an average across electrode sites
full_withERP$ERPBaselineDiff_allsites <- 
  rowMeans(full_withERP[c("BaselineDiff_Cz", "BaselineDiff_FC1", "BaselineDiff_FC2", "BaselineDiff_Fz")])
## Regression for diary intake
summary(lm(Daily_intake ~ ERPBaselineDiff_allsites + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(Daily_intake ~ ERPBaselineDiff_allsites + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
## And for lab food intake
summary(lm(total_in_lab ~ ERPBaselineDiff_allsites + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(total_in_lab ~ ERPBaselineDiff_allsites + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
summary(lm(total_in_lab ~ ERPBaselineDiff_allsites + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier_notdaily == "0")))
```

None of the electrode sites show an effect (whether we include outliers or not), so we can confidently conclude that N2-baseline bias was not predictive of food intake inside and outside the laboratory.

(NB: removing the participants with no and/or reversed GNG effect did not change results)

# Hypothesis 4: Food intake outcomes.

We see _higher_ food consumption after the _Low-Calorie-Go_ condition.

```{r}
# Let's look at some of the food intake outcomes
## Lab intake
full_withERP %>% summarise_at(vars(after_High_Cal_Go, after_Low_Cal_Go), funs(mean, sd))
### Descriptively, participants ate MORE after Low_Cal_Go (against the hypothesis!)
### Let's run a t-test on that
t.test(full_withERP$after_High_Cal_Go, full_withERP$after_Low_Cal_Go, paired = TRUE, alternative = "greater")
## No significant difference between consumption after HighCalGo vs LowCalGo

## Lab intake by timepoint
full_withERP %>% summarise_at(vars(consumed_T1, consumed_T2), mean)
t.test(full_withERP$consumed_T1, full_withERP$consumed_T2, paired = TRUE, alternative = "greater") 
#No significant differences between timepoints
```

To give an idea about how much participants ate at the two time points:

```{r}
lab_intake_time <- select(full_withERP,
                     Subject,
                     consumed_T1, 
                     consumed_T2) %>%
  gather("timepoint", "amount", -Subject)
mean_lab_intake_time <- lab_intake_time %>%
  group_by(timepoint) %>%
  summarise_at(., "amount", funs(amount = mean))
ggplot(lab_intake_time, aes(timepoint, amount, group = Subject, color = Subject)) + 
  geom_point(alpha = 0.3) +
  geom_line(stat = "identity")

lab_intake_training <- select(full_withERP,
                          Subject,
                          after_High_Cal_Go, 
                          after_Low_Cal_Go) %>%
  gather("training", "amount", -Subject)
ggplot(lab_intake_training, aes(training, amount, group = Subject, color = Subject)) + 
  geom_point() +
  geom_line(stat = "identity")
```

## Without the outlier participants

```{r}
# Let's look at some of the food intake outcomes
## Lab intake
full_withERP %>% 
  subset(outlier == 0) %>%
  summarise_at(vars(after_High_Cal_Go, after_Low_Cal_Go), mean)
### Descriptively, participants ate MORE after Low_Cal_Go (against the hypothesis!)
### Let's run a t-test on that
t.test(subset(full_withERP$after_High_Cal_Go, full_withERP$outlier == 0), 
       subset(full_withERP$after_Low_Cal_Go, full_withERP$outlier == 0), 
       paired = TRUE, alternative = "less")
### A one-sided t-test does not show a signigicant difference

## Lab intake by timepoint
full_withERP %>% 
  subset(outlier == 0) %>%
  summarise_at(vars(consumed_T1, consumed_T2), mean)
t.test(subset(full_withERP$consumed_T1, full_withERP$outlier == 0), subset(full_withERP$consumed_T2, full_withERP$outlier == 0),
       paired = TRUE, alternative = "greater") 
#No significant differences between timepoints
```

And again, some visualization:

```{r}
lab_intake_time <- full_withERP %>% 
  subset(outlier == 0) %>% 
  select(Subject,
         consumed_T1, 
         consumed_T2) %>%
  gather("timepoint", "amount", -Subject)

ggplot(lab_intake_time, aes(timepoint, amount, group = Subject, color = Subject)) + 
  geom_point() +
  geom_line(stat = "identity")

lab_intake_training <- full_withERP %>% 
  subset(outlier == 0) %>% 
  select(Subject,
         consumed_T1, 
         consumed_T2) %>%
  gather("training", "amount", -Subject)

ggplot(lab_intake_training, aes(training, amount, group = Subject, color = Subject)) + 
  geom_point() +
  geom_line(stat = "identity")
```


# Hypothesis 5: Training effects on N2

The hypothesis is that N2 becomes more pronounced with training, i.e. the values are more extreme in Cycle 2 than Cycle 1 and that this change is more pronounced for high calorie food (i.e. an interaction between differences with type of food).

```{r}
ERP_anova_change <- full_withERP %>%
  select(pp, LowCalGo_DiffCz_1:HighCalGo_DiffFz_2, outlier, outlier_notdaily) %>%
  gather("Block.electrode.Cycle", "difference.score", LowCalGo_DiffCz_1:HighCalGo_DiffFz_2) %>%
  separate(col = Block.electrode.Cycle, into = c("Block", "Electrode", "Cycle"), sep = "_")

aov_car(difference.score ~ Block*Cycle + Error(pp/Block*Cycle), 
        data=ERP_anova_change)

## We have a main effect for Cycle (with later cycle showing stronger N2 difference scores) 
## but no main effect of Block or interaction effect.

summary_ERP_change <- ERP_anova_change %>% 
  group_by(Block, Cycle) %>% 
  summarise_at(., "difference.score", funs(mean, median, sd))

ggplot(summary_ERP_change, aes(Cycle, mean, colour = Block, group = Block)) +
  geom_point() +
  geom_line(stat = "identity") +
  geom_errorbar(aes(ymin = mean-2*(sd/49), ymax = mean+2*(sd/49)), inherit = TRUE, width = 0.1) +
  xlab("Time") +
  ylab("N2-difference score")
```

So we _do_ see the expected main effect of Cycle, but no main effect of Block and _no_ interaction.

(NB: removing the participants with no and/or reversed GNG effect did not change results)

## Without outliers

Without all kinds of outliers:

```{r}
aov_car(difference.score ~ Block*Cycle + Error(pp/Block*Cycle), 
        data=subset(ERP_anova_change, outlier == 0))

## Same as with outliers

ggplot(subset(ERP_anova_change, outlier == 0), aes(Cycle, difference.score, color = Block)) + geom_boxplot()
subset(ERP_anova_change, outlier == 0) %>% group_by(Block, Cycle) %>% summarise_at(., "difference.score", funs(mean, sd))
```

And admitting the outlier criterion not including diary intake:

```{r}
aov_car(difference.score ~ Block*Cycle + Error(pp/Block*Cycle), 
        data=subset(ERP_anova_change, outlier_notdaily == 0))

## And again the same.

ggplot(subset(ERP_anova_change, outlier_notdaily == 0), aes(Cycle, difference.score, color = Block)) + geom_boxplot()
subset(ERP_anova_change, outlier_notdaily == 0) %>% group_by(Block, Cycle) %>% summarise_at(., "difference.score", funs(mean, sd))
```

# An add-on to Hypothesis 3: RT-bias and food intake

## Baseline RT bias

Using baseline RT-bias to predict food intake:

```{r}
# Diary data
summary(full_withERP$Daily_intake) 
# So the average reported intake is 8360 kJ with a max of 29521 kJ (7055 kcal) 
# and a min of 2380 kJ (569 kcal)

ggplot(full_withERP, aes(Subject, Daily_intake)) + 
  geom_point()

## Let's do a regression with High-Cal-Go minus Low-Cal-Go at baseline (baseline bias) 
## predicting food intake

summary(lm(Daily_intake ~ baseline_RTbias + as.numeric(Age) + Sex + BMI, data = full_withERP))
## And for lab food intake
summary(lm(total_in_lab ~ baseline_RTbias + as.numeric(Age) + Sex + BMI, data = full_withERP))
### Both regression coefficients are not significant
```

So here we see that the "baseline bias" (i.e. reaction times to high-calorie items minus reaction times to low-calorie items) is _not_ related to intake as reported in the diary or in the lab.

### Without outlier participants

```{r}
# Diary data
summary(subset(full_withERP$Daily_intake, full_withERP$outlier == 0)) 
# So the average reported intake is 7891 kJ with a max of 17270 kJ and a min of 3369 kJ
ggplot(subset(full_withERP, outlier==0), aes(Subject, Daily_intake)) + 
  geom_point()

## Let's do a regression with High-Cal-Go minus Low-Cal-Go at baseline (baseline bias) 
## predicting food intake

summary(lm(Daily_intake ~ baseline_RTbias + as.numeric(Age) + Sex + BMI, 
           data = subset(full_withERP, outlier==0)))
## And for lab food intake
summary(lm(total_in_lab ~ baseline_RTbias + as.numeric(Age) + Sex + BMI, 
           data = subset(full_withERP, outlier==0)))
### Both regression coefficients are not significant
```

So there is still no association between baseline RT bias and food intake.

## Training RT bias

Now we'll also look at bias in the training blocks, i.e. reaction times to dominant Go-trials in the respective blocks.

```{r}
# Regression
summary(lm(Daily_intake ~ training_RTbias + as.numeric(Age) + Sex + BMI, data = full_withERP))
# the training bias is predictive of diary intake! (p = .045, though)

## And for lab food intake
summary(lm(total_in_lab ~ training_RTbias + as.numeric(Age) + Sex + BMI, data = full_withERP))
### Not significant
```

So training bias is predictive of food intake as reported in the food diary (at _p_=.045, though) but not of in-lab fod intake.

### Without outlier participants

```{r}
# Regression
summary(lm(Daily_intake ~ training_RTbias + as.numeric(Age) + Sex + BMI, 
           data = subset(full_withERP, outlier==0)))
# the training bias is not predictive of diary intake!

## And for lab food intake
summary(lm(total_in_lab ~ training_RTbias + as.numeric(Age) + Sex + BMI, 
           data = subset(full_withERP, outlier==0)))
### Not significant 

ggplot(data = subset(full_withERP, outlier==0), 
       aes(x = baseline_RTbias, y = total_in_lab)) +
         geom_point() +
         geom_smooth(method = "lm")
```

But no significant relation left after removing outliers.

# Relation between N2 differences and training effects
So now we check whether the difference between intake after High-Calorie Go and Low-Calorie Go is related to the baseline N2 difference score (the score from hypothesis 3).

```{r}
summary(lm(lab_food_diff ~ ERPBaselineDiff_allsites, data = full_withERP))
```

There is no relation between these two.

## Without outliers
```{r}
summary(lm(lab_food_diff ~ ERPBaselineDiff_allsites, data = subset(full_withERP, outlier==0)))
summary(lm(lab_food_diff ~ ERPBaselineDiff_allsites, data = subset(full_withERP, outlier_notdaily==0)))
```

And removing outliers doesn't change anything about that.

# N2-difference change values

Let's create a variable indicating the change in N2-bias from Cycle 1 to Cycle 2 in the training blocks (an indidvidual "training score" if you will).

```{r}
full_withERP$N2_bias_change_LowCalGo_Cz <- (full_withERP$LowCalGo_DiffCz_1 - full_withERP$LowCalGo_DiffCz_2)
full_withERP$N2_bias_change_HighCalGo_Cz <- (full_withERP$HighCalGo_DiffCz_1 - full_withERP$HighCalGo_DiffCz_2)
full_withERP$N2_bias_change_LowCalGo_FC1 <- (full_withERP$LowCalGo_DiffFC1_1 - full_withERP$LowCalGo_DiffFC1_2)
full_withERP$N2_bias_change_HighCalGo_FC1 <- (full_withERP$HighCalGo_DiffFC1_1 - full_withERP$HighCalGo_DiffFC1_2)
full_withERP$N2_bias_change_LowCalGo_FC2 <- (full_withERP$LowCalGo_DiffFC2_1 - full_withERP$LowCalGo_DiffFC2_2)
full_withERP$N2_bias_change_HighCalGo_FC2 <- (full_withERP$HighCalGo_DiffFC2_1 - full_withERP$HighCalGo_DiffFC2_2)
full_withERP$N2_bias_change_LowCalGo_Fz <- (full_withERP$LowCalGo_DiffFz_1 - full_withERP$LowCalGo_DiffFz_2)
full_withERP$N2_bias_change_HighCalGo_Fz <- (full_withERP$HighCalGo_DiffFz_1 - full_withERP$HighCalGo_DiffFz_2)
# And create a mean value across electrode sites
full_withERP$N2_bias_change_LowCalGo <- 
  rowMeans(full_withERP[c("N2_bias_change_LowCalGo_Cz", "N2_bias_change_LowCalGo_FC1", "N2_bias_change_LowCalGo_FC2", "N2_bias_change_LowCalGo_Fz")])
full_withERP$N2_bias_change_HighCalGo <- 
  rowMeans(full_withERP[c("N2_bias_change_HighCalGo_Cz", "N2_bias_change_HighCalGo_FC1", "N2_bias_change_HighCalGo_FC2", "N2_bias_change_HighCalGo_Fz")])
```

And let's see how these "training scores" relate to food intake:

```{r}
# For the learning scores in the LowCalGo block
summary(lm(Daily_intake ~ N2_bias_change_LowCalGo, data = full_withERP))
# For the learning scores in the LowCalGo block
summary(lm(Daily_intake ~ N2_bias_change_HighCalGo, data = full_withERP))
``` 

No significant relation.

# N2 change values

Now here I create _change_ scores by trial type, so how much did N2 change from T1 to T2, depending on calorie content and Go vs No-Go.

```{r}
# Let's create change scores by trial type:
full_withERP$N2change_HighGo <- 
  (full_withERP$HighGo_1_HighCalGo.allsites - full_withERP$HighGo_2_HighCalGo.allsites)
full_withERP$N2change_HighNo <- 
  (full_withERP$HighNo_1_LowCalGo.allsites - full_withERP$HighNo_2_LowCalGo.allsites)

full_withERP$N2change_LowGo <- 
  (full_withERP$LowGo_1_LowCalGo.allsites - full_withERP$LowGo_2_LowCalGo.allsites)
full_withERP$N2change_LowNo <- 
  (full_withERP$LowNo_1_HighCalGo.allsites - full_withERP$LowNo_2_HighCalGo.allsites)

N2_change_df <- full_withERP %>%
  select(N2change_HighGo:N2change_LowNo, pp) %>%
  gather("trialtype", "N2_change", N2change_HighGo:N2change_LowNo) %>%
  separate(col = trialtype, into = c("HighLow", "GoNo"), sep = -2) %>%
  mutate(., HighLow = sapply(strsplit(HighLow, split = "_", fixed = TRUE), function(x) (x[2])))

aov_car(N2_change ~ HighLow*GoNo + Error(pp/HighLow*GoNo),
        data=N2_change_df)
# This shows that the CHANGE in N2 does not differ between trial types, i.e. it's the same for Go/No-Go trials and High/Low calorie stimuli

plot_N2_change_df <- 
  N2_change_df %>% 
  group_by(HighLow, GoNo) %>% 
  summarise_at(., "N2_change", funs("mean_change" = mean, sd))

ggplot(plot_N2_change_df, aes(x = GoNo, y = mean_change, colour = HighLow)) +
  geom_point() + 
  geom_errorbar(aes(ymin = mean_change-2*(sd/nrow(ERP_tidy)), ymax = mean_change+2*(sd/nrow(ERP_tidy))), inherit = TRUE, width = 0.1)
# Obviously, the standard deviation is really large - there's a lot of variation in the N2 amplitudes
# But also, N2 on No-Go trials really hardly changes at all.
```

Let's ignore the training effects for a moment and focus on _overall_ N2s in the bias blocks.

```{r}
ERP_plot_by_trialtype <- full_withERP %>%
  select(pp,
         HighGo_1_HighCalGo.allsites,
         HighGo_2_HighCalGo.allsites,
         LowNo_1_HighCalGo.allsites,
         LowNo_2_HighCalGo.allsites,
         HighNo_1_LowCalGo.allsites,
         HighNo_2_LowCalGo.allsites, 
         LowGo_1_LowCalGo.allsites, 
         LowGo_2_LowCalGo.allsites)%>%
  gather("Trial.Cycle.Block", "N2", HighGo_1_HighCalGo.allsites:LowGo_2_LowCalGo.allsites) %>%
  separate(col = Trial.Cycle.Block, into = c("Trial", "Cycle", "Block"), sep = "_")

ERP_plot_2by2Trial <- ERP_plot_by_trialtype %>%
  separate(col = Trial, into = c("HighLow", "GoNo"), sep = -2)

ERP_plot_by_trialtype_summary <- ERP_plot_2by2Trial %>% group_by(HighLow, GoNo) %>% summarise_at(., "N2", funs(mean, sd))

ggplot(ERP_plot_by_trialtype_summary, aes(x = HighLow, mean, color = GoNo, group = GoNo)) +
  geom_point() + 
  geom_errorbar(aes(ymin = mean-2*(sd/49), ymax = mean+2*(sd/49)), inherit = TRUE, width = 0.1)

aov_car(N2 ~ HighLow*GoNo + Error(pp/HighLow*GoNo),
                                  data = ERP_plot_2by2Trial)
```

And now let's include Cycle again as a variable to take another closer look.

```{r}
ERP_plot_by_trialtype_by_Cycle_summary <- ERP_plot_2by2Trial %>% group_by(HighLow, GoNo, Cycle) %>% summarise_at(., "N2", funs(mean, sd))

ggplot(ERP_plot_by_trialtype_by_Cycle_summary, aes(x = Cycle, mean, color = GoNo, group = GoNo)) +
  geom_point() + 
  geom_line(stat = "identity") +
  geom_errorbar(aes(ymin = mean-2*(sd/nrow(ERP_tidy)), ymax = mean+2*(sd/nrow(ERP_tidy))), width = 0.1) +
  facet_wrap(aes(Facets = HighLow)) +
  ggtitle("Mean Ns for dominant trials in the Bias blocks")

aov_car(N2 ~ HighLow*GoNo*Cycle + Error(pp/HighLow*GoNo*Cycle), 
        data = ERP_plot_2by2Trial)
```

This is looking at Go vs NoGo, High vs Low, and Cycle instead of difference scores (which, of course, leads to nasty three-way interaction terms). Again, there's significant main effects of GoNo but nothing else.
All this indicates that N2 is just less on Go than on NoGo trials (which is pretty trivial). On the bright side, there are no three-way interactions to interpret...

Let's check out the time course in the Balanced block to see if there is a training effect there already.

```{r}
Balanced_Cycles <- full_withERP %>%
  select(pp,
         HighGo_1_Balanced.allsites:LowNo_2_Balanced.allsites) %>%
  gather("Trial_Cycle_Block", "N2", HighGo_1_Balanced.allsites:LowNo_2_Balanced.allsites) %>%
  separate(col = Trial_Cycle_Block, into = c("Trial", "Cycle", "Block"), sep = "_") %>%
  separate(col = "Trial", into = c("HighLow", "GoNo"), sep = -2) %>%
  group_by(HighLow, GoNo, Cycle)

Balanced_Cycles_summary <- Balanced_Cycles %>%
  summarise_at(., "N2", funs("mean_N2" = mean, sd))

ggplot(Balanced_Cycles_summary, aes(x = Cycle, y = mean_N2, color = GoNo, group = GoNo)) +
  geom_point() + 
  geom_line(stat = "identity") +
  geom_errorbar(aes(ymin = mean_N2-2*(sd/nrow(ERP_tidy)), ymax = mean_N2+2*(sd/nrow(ERP_tidy))), inherit = TRUE, width = 0.1) +
  facet_wrap(aes(Facets = HighLow)) +
  ggtitle("Mean N2 by Cycle, calorie content, and Go vs No in the Balanced Block") +
  ylim(-6, -2.5)

aov_car(N2 ~ HighLow*GoNo*Cycle + Error(pp/HighLow*GoNo*Cycle),
        data = Balanced_Cycles)
```

And then for the biased blocks.

```{r}
Bias_Cycles <- full_withERP %>%
  select(pp,
         HighGo_1_HighCalGo.allsites, HighGo_2_HighCalGo.allsites,
         HighNo_1_LowCalGo.allsites, HighNo_2_LowCalGo.allsites,
         LowGo_1_LowCalGo.allsites, LowGo_2_LowCalGo.allsites,
         LowNo_1_HighCalGo.allsites, LowNo_2_HighCalGo.allsites) %>%
  gather("Trial_Cycle_Block", "N2", HighGo_1_HighCalGo.allsites:LowNo_2_HighCalGo.allsites) %>%
  separate(col = Trial_Cycle_Block, into = c("Trial", "Cycle", "Block"), sep = "_") %>%
  separate(col = "Trial", into = c("HighLow", "GoNo"), sep = -2) %>%
  group_by(HighLow, GoNo, Cycle)

Bias_Cycles_summary <- Bias_Cycles %>%
  summarise_at(., "N2", funs("mean_N2" = mean, sd))

ggplot(Bias_Cycles_summary, aes(x = Cycle, y = mean_N2, color = GoNo, group = GoNo)) +
  geom_point() + 
  geom_line(stat = "identity") +
  geom_errorbar(aes(ymin = mean_N2-2*(sd/nrow(ERP_tidy)), ymax = mean_N2+2*(sd/nrow(ERP_tidy))), inherit = TRUE, width = 0.1) +
  facet_wrap(aes(Facets = HighLow)) +
  ggtitle("Mean N2 by Cycle, calorie content, and Go vs No in the Biased Blocks") +
  ylim(-6, -2.5)

aov_car(N2 ~ HighLow*GoNo*Cycle + Error(pp/HighLow*GoNo*Cycle),
        data = Bias_Cycles)
```

So the effects in the Balanced block are pretty much the same as in the Bias blocks: Main effect of Go vs No but no more. This seems to indicate that the training blocks don't do anything that the Balanced block doesn't also do...

(NB: results do not change considerably when removing participants with no/reversed GNG effect)

## With retaining "Electrode"

We can of course use electrode as a factor as well.

### For bias blocks

```{r}
Bias_Cycles_electrodes <- full_withERP %>%
  select(pp,
         High_Go.1.HighCalGo.Cz, High_Go.2.HighCalGo.Cz,
         High_No.1.LowCalGo.Cz, High_No.2.LowCalGo.Cz,
         Low_Go.1.LowCalGo.Cz, Low_Go.2.LowCalGo.Cz,
         Low_No.1.HighCalGo.Cz, Low_No.2.HighCalGo.Cz,
         High_Go.1.HighCalGo.FC1, High_Go.2.HighCalGo.FC1,
         High_No.1.LowCalGo.FC1, High_No.2.LowCalGo.FC1,
         Low_Go.1.LowCalGo.FC1, Low_Go.2.LowCalGo.FC1,
         Low_No.1.HighCalGo.FC1, Low_No.2.HighCalGo.FC1,
         High_Go.1.HighCalGo.FC2, High_Go.2.HighCalGo.FC2,
         High_No.1.LowCalGo.FC2, High_No.2.LowCalGo.FC2,
         Low_Go.1.LowCalGo.FC2, Low_Go.2.LowCalGo.FC2,
         Low_No.1.HighCalGo.FC2, Low_No.2.HighCalGo.FC2,
         High_Go.1.HighCalGo.Fz, High_Go.2.HighCalGo.Fz,
         High_No.1.LowCalGo.Fz, High_No.2.LowCalGo.Fz,
         Low_Go.1.LowCalGo.Fz, Low_Go.2.LowCalGo.Fz,
         Low_No.1.HighCalGo.Fz, Low_No.2.HighCalGo.Fz) %>%
  gather("Trial_Cycle_Block_Electrode", "N2", High_Go.1.HighCalGo.Cz:Low_No.2.HighCalGo.Fz) %>%
  separate(col = "Trial_Cycle_Block_Electrode", into = c("HighLow", "GoNo", "Cycle", "Block", "Electrode"), sep = "([\\.\\_])")
  

Bias_Cycles_electrodes_summary <- Bias_Cycles_electrodes %>% 
  group_by(HighLow, GoNo, Cycle, Electrode) %>% 
  summarise_at(., "N2", funs("mean_N2" = mean, sd))

ggplot(Bias_Cycles_electrodes_summary, aes(x = Cycle, y = mean_N2, color = GoNo, group = interaction(GoNo,HighLow), shape = HighLow)) +
  geom_point(size = 3) + 
  geom_line(stat = "identity") +
  geom_errorbar(aes(ymin = mean_N2-2*(sd/nrow(ERP_tidy)), ymax = mean_N2+2*(sd/nrow(ERP_tidy))), width = 0.1) +
  facet_wrap(aes(Facets = Electrode)) +
  ggtitle("Mean N2 by Cycle, calorie content, electrode, and Go vs No in the Biased Blocks")

aov_car(N2 ~ HighLow*GoNo*Cycle*Electrode + Error(pp/HighLow*GoNo*Cycle*Electrode),
        data = Bias_Cycles_electrodes)
```

So this gives us (1) a main effect of Go-NoGo, (2) a main effect of Electrode and (3) an interaction between Go-NoGo and Electrode site, indicating that the Go-NoGo effect is more pronouned in some electrodes than others. No higher order interactions are significant, so there doesn't seem to be e.g. an effect of food on Go-NoGo effects in some electrodes. (Roughly judging from the graphs, Go-NoGo effects seem mpst pronounced in Cz)

### For the balanced block

```{r}
Balanced_Cycles_electrodes <- full_withERP %>%
  select(pp,
         High_Go.1.Balanced.Cz, High_Go.2.Balanced.Cz,
         High_No.1.Balanced.Cz, High_No.2.Balanced.Cz,
         Low_Go.1.Balanced.Cz, Low_Go.2.Balanced.Cz,
         Low_No.1.Balanced.Cz, Low_No.2.Balanced.Cz,
         High_Go.1.Balanced.FC1, High_Go.2.Balanced.FC1,
         High_No.1.Balanced.FC1, High_No.2.Balanced.FC1,
         Low_Go.1.Balanced.FC1, Low_Go.2.Balanced.FC1,
         Low_No.1.Balanced.FC1, Low_No.2.Balanced.FC1,
         High_Go.1.Balanced.FC2, High_Go.2.Balanced.FC2,
         High_No.1.Balanced.FC2, High_No.2.Balanced.FC2,
         Low_Go.1.Balanced.FC2, Low_Go.2.Balanced.FC2,
         Low_No.1.Balanced.FC2, Low_No.2.Balanced.FC2,
         High_Go.1.Balanced.Fz, High_Go.2.Balanced.Fz,
         High_No.1.Balanced.Fz, High_No.2.Balanced.Fz,
         Low_Go.1.Balanced.Fz, Low_Go.2.Balanced.Fz,
         Low_No.1.Balanced.Fz, Low_No.2.Balanced.Fz) %>%
  gather("Trial_Cycle_Block_Electrode", "N2", High_Go.1.Balanced.Cz:Low_No.2.Balanced.Fz) %>%
  separate(col = "Trial_Cycle_Block_Electrode", into = c("HighLow", "GoNo", "Cycle", "Block", "Electrode"), sep = "([\\.\\_])")
  

Balanced_Cycles_electrodes_summary <- Balanced_Cycles_electrodes %>% 
  group_by(HighLow, GoNo, Cycle, Electrode) %>% 
  summarise_at(., "N2", funs("mean_N2" = mean, sd))

ggplot(Balanced_Cycles_electrodes_summary, aes(x = Cycle, y = mean_N2, color = GoNo, group = interaction(GoNo,HighLow), shape = HighLow)) +
  geom_point(size = 3) + 
  geom_line(stat = "identity") +
  geom_errorbar(aes(ymin = mean_N2-2*(sd/nrow(ERP_tidy)), ymax = mean_N2+2*(sd/nrow(ERP_tidy))), width = 0.1) +
  facet_wrap(aes(Facets = Electrode)) +
  ggtitle("Mean N2 by Cycle, calorie content, electrode, and Go vs No in the Biased Blocks")

aov_car(N2 ~ HighLow*GoNo*Cycle*Electrode + Error(pp/HighLow*GoNo*Cycle*Electrode),
        data = Balanced_Cycles_electrodes)
```

Good luck interpreting these results...
From a first glance it seems like Cz might contain some interesting trends: Possibly a main effect of Cycle there. 
Problem: Only the one-way interactions between between Electrode and HighLow, GoNo, and Cycle are significant but no higher order interactions. (side note: when running an ANOVA with Cz data only, we don't get anything special out of it either, just a Go-NoGo effect and main effect of Cycle at p=.06)

# Correlation tables
Let's plot correlations between some variables of interest:

```{r}
GGally::ggpairs(full_withERP[ ,c("Daily_intake", "BMI", "overall_hunger", "total_in_lab", "baseline_RTbias", "HighNo_1_Balanced.allsites", "HighGo_1_Balanced.allsites", "ERPBaselineDiff_allsites", "N2change_HighGo", "N2change_HighNo", "N2change_LowGo", "N2change_LowNo")])
```
