---
title: "EEG GNG"
output:
  html_document:
    code_folding: hide
    number_sections: yes
    df_print: paged
    toc: yes
    toc_float: true
  pdf_document:
    number_sections: yes
    toc: yes
---

```{r setup, include=FALSE, error=FALSE, warning=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE, error=FALSE, warning=FALSE)
pacman::p_load(tidyverse, rprime, wrapr, ggplot2, xlsx, here, lmerTest)
test_dats_raw <- readRDS("E-Prime data/raw_RT_data.rds")
```


```{r outlier removal, echo=FALSE}
test_dats_trim <- test_dats_raw %>% 
  select(-c(2:15), -BMI) %>%
  subset(!is.na(Stim.RT))
test_dats_trim$Subject <- as.numeric(test_dats_trim$Subject)
test_dats_trim$Running <- as.factor(test_dats_trim$Running)

test_dats_trim$accuracy <- ifelse(test_dats_trim$commission == 1 | 
                                          test_dats_trim$ommission == 1, 0, 1)


# Converting test_dats_trim to a data.frame object since sdTrim apparently can only handle that class of object

test_dats_trim <- as.data.frame(test_dats_trim)

# This removes outliers per condition, i.e. within balanced, HighCalGo, and LowCalGo blocks, respectively
## It ALSO removes error trials since I included minRT = 150 (and error trials have "0" reaction time). 
## Note that "minRT" removes the RTs below the threshold BEFORE doing the SD trimming.
test_dats <- trimr::sdTrim(data = subset(test_dats_trim, 
                                  (test_dats_trim$GOorNO == "GO") & 
                                    (!is.na(test_dats_trim$Stim.RT)) & 
                                    (Running == "TrialListTestBalanced" |
                                       Running == "TrialListHighCalGo" |
                                       Running == "TrialListLowCalGo")), condVar = "Running", pptVar = "Subject", rtVar = "Stim.RT",
                              perCondition = TRUE, perParticipant = TRUE,
                               minRT = 150, sd = 3, returnType = "raw", digits = 0)

## Note that "test_dats" now holds GO trials only!
```


```{r, echo=FALSE}
## RT grouped by Subject, Primetype, Block (Assessment, HighCalGo, LowCalGo), and Cycle
RT_by_subject <- subset(test_dats, (Primetype == "HighGo" | Primetype == "LowGo")) %>% 
  filter(!is.na(Stim.RT)) %>% 
  filter(Running != "TrialListTrain") %>%
  group_by(Subject, Primetype, Running, Cycle) %>%
  dplyr::summarize(meanRT = mean(Stim.RT, na.rm = TRUE), sdRT = sd(Stim.RT, na.rm = TRUE))
## Let's make RT_by_subject tidy
RT_tidy <- RT_by_subject %>%
  select(-sdRT) %>%
  unite(Prime_Running, Primetype, Running) %>%
  unite(Prime_Running_Cycle, Prime_Running, Cycle) %>%
  spread(key = Prime_Running_Cycle, value = meanRT)
## Need to put age etc. back into the dataframe
RT_tidy$Age <- as.numeric(subset(test_dats_raw$Age, !is.na(test_dats_raw$Age)))
RT_tidy$Sex <- subset(test_dats_raw$Sex, !is.na(test_dats_raw$Sex))
RT_tidy$Handedness <- subset(test_dats_raw$Handedness, !is.na(test_dats_raw$Handedness))
RT_tidy$Height <- subset(test_dats_raw$Height, !is.na(test_dats_raw$Height))
RT_tidy$Weight <- subset(test_dats_raw$Weight, !is.na(test_dats_raw$Weight))
RT_tidy$BMI <- subset(test_dats_raw$BMI, !is.na(test_dats_raw$BMI))
```

```{r, echo=FALSE}
# Out of curiosity, we can check the evaluations of different food items
food_evals <- test_dats_raw %>% 
  filter(!is.na(FoodEvalItems.RESP)) %>%
  group_by(FoodPic) %>%
  summarize(mean = mean(FoodEvalItems.RESP), sd = sd(FoodEvalItems.RESP))
```

```{r data wrangling, echo=FALSE}
###### Read in all the other data
food_hunger_lasteaten <- readRDS("./diaries/food_hunger_lasteaten.rds")
###### And the ERP data:
ERP_tidy <- readRDS("ERP_tidy.rds")
# Creating the baseline difference scores
## since there are two values for each electrode and trial type (the two cycles), I average across those
ERP_tidy <- ERP_tidy %>%
  mutate(BaselineDiff_Cz = (((High_No.1.Balanced.Cz_200to290 + High_No.2.Balanced.Cz_200to290)/2) - ((High_Go.1.Balanced.Cz_200to290 + High_Go.2.Balanced.Cz_200to290)/2)) -
           (((Low_No.1.Balanced.Cz_200to290 + Low_No.2.Balanced.Cz_200to290)/2) - ((Low_Go.1.Balanced.Cz_200to290 + Low_Go.2.Balanced.Cz_200to290)/2)),
         BaselineDiff_FC1 = (((High_No.1.Balanced.FC1_200to290 + High_No.2.Balanced.FC1_200to290)/2) - ((High_Go.1.Balanced.FC1_200to290 + High_Go.2.Balanced.FC1_200to290)/2)) -
           (((Low_No.1.Balanced.FC1_200to290 + Low_No.2.Balanced.FC1_200to290)/2) - ((Low_Go.1.Balanced.FC1_200to290 + Low_Go.2.Balanced.FC1_200to290)/2)),
         BaselineDiff_FC2 = (((High_No.1.Balanced.FC2_200to290 + High_No.2.Balanced.FC2_200to290)/2) - ((High_Go.1.Balanced.FC2_200to290 + High_Go.2.Balanced.FC2_200to290)/2)) -
           (((Low_No.1.Balanced.FC2_200to290 + Low_No.2.Balanced.FC2_200to290)/2) - ((Low_Go.1.Balanced.FC2_200to290 + Low_Go.2.Balanced.FC2_200to290)/2)),
         BaselineDiff_Fz = (((High_No.1.Balanced.Fz_200to290 + High_No.2.Balanced.Fz_200to290)/2) - ((High_Go.1.Balanced.Fz_200to290 + High_Go.2.Balanced.Fz_200to290)/2)) -
           (((Low_No.1.Balanced.Fz_200to290 + Low_No.2.Balanced.Fz_200to290)/2) - ((Low_Go.1.Balanced.Fz_200to290 + Low_Go.2.Balanced.Fz_200to290)/2))
  )
```

```{r}
# The final tidy data frame!
diaries_weekdays <- read.table("./diaries/diaries_weekdays.txt", header = TRUE, sep = "\t")
full_dat <- full_join(food_hunger_lasteaten, RT_tidy, by = "Subject")
ERP_tidy$Subject <- as.numeric(ERP_tidy$pp)
full_withERP <- full_join(full_dat, ERP_tidy, by = "Subject")
# adding the "Order" variable
## need to make "Subject" numeric
full_withERP$Subject <- as.numeric(full_withERP$Subject)
full_withERP$Order <- ifelse((full_withERP$Subject %% 2) == 0, "LowHigh", "HighLow")
full_withERP$Subject <- as.factor(full_withERP$Subject)
# Also adding a variable indicating total in-lab food intake
full_withERP$total_in_lab <- full_withERP$consumed_T1 + full_withERP$consumed_T2
## Let's rename those columns
full_withERP <- plyr::rename(full_withERP, c("HighGo_TrialListHighCalGo_1"="High_HighGo_1", 
                         "HighGo_TrialListHighCalGo_2"="High_HighGo_2",
                         "HighGo_TrialListHighCalGo_3"="High_HighGo_3",
                         "HighGo_TrialListHighCalGo_4"="High_HighGo_4",
                         "HighGo_TrialListLowCalGo_1"="High_LowGo_1",
                         "HighGo_TrialListLowCalGo_2"="High_LowGo_2",
                         "HighGo_TrialListLowCalGo_3"="High_LowGo_3",
                         "HighGo_TrialListLowCalGo_4"="High_LowGo_4",
                         "HighGo_TrialListTestBalanced_1"="High_Balanced_1",
                         "HighGo_TrialListTestBalanced_2"="High_Balanced_2",
                         "HighGo_TrialListTestBalanced_3"="High_Balanced_3",
                         "HighGo_TrialListTestBalanced_4"="High_Balanced_4",
                         "LowGo_TrialListHighCalGo_1"="Low_HighGo_1", 
                         "LowGo_TrialListHighCalGo_2"="Low_HighGo_2",
                         "LowGo_TrialListHighCalGo_3"="Low_HighGo_3",
                         "LowGo_TrialListHighCalGo_4"="Low_HighGo_4",
                         "LowGo_TrialListLowCalGo_1"="Low_LowGo_1",
                         "LowGo_TrialListLowCalGo_2"="Low_LowGo_2",
                         "LowGo_TrialListLowCalGo_3"="Low_LowGo_3",
                         "LowGo_TrialListLowCalGo_4"="Low_LowGo_4",
                         "LowGo_TrialListTestBalanced_1"="Low_Balanced_1",
                         "LowGo_TrialListTestBalanced_2"="Low_Balanced_2",
                         "LowGo_TrialListTestBalanced_3"="Low_Balanced_3",
                         "LowGo_TrialListTestBalanced_4"="Low_Balanced_4"))

# Creating baseline bias variable
full_withERP$baseline_high_go <- (full_withERP$High_Balanced_1 + full_withERP$High_Balanced_2 +
                                full_withERP$High_Balanced_3 + full_withERP$High_Balanced_4)/4
full_withERP$baseline_low_go <- (full_withERP$Low_Balanced_1 + full_withERP$Low_Balanced_2 +
                                full_withERP$Low_Balanced_3 + full_withERP$Low_Balanced_4)/4
full_withERP$baseline_RTbias <- full_withERP$baseline_high_go - full_withERP$baseline_low_go

# Calculating the training block bias
full_withERP$high_bias_high_go <- (full_withERP$High_HighGo_1 + full_withERP$High_HighGo_2 +
                                full_withERP$High_HighGo_3 + full_withERP$High_HighGo_4)/4
full_withERP$low_bias_low_go <- (full_withERP$Low_LowGo_1 + full_withERP$Low_LowGo_2 +
                                full_withERP$Low_LowGo_3 + full_withERP$Low_LowGo_4)/4
full_withERP$training_RTbias <- full_withERP$high_bias_high_go - full_withERP$low_bias_low_go

# Difference between time points
full_withERP$lab_food_diff <- full_withERP$after_High_Cal_Go - full_withERP$after_Low_Cal_Go

# Creating a mean score for hunger etc.
## Inverting the "full"-item
full_withERP$full_inv <- car::recode(full_withERP$Full.RESP, '1=7; 2=6; 3=5; 4=4; 5=3; 6=2; 7=1')
## taking the mean of all thos variables
full_withERP$overall_hunger <- rowMeans(full_withERP[c("full_inv", "Hungry.RESP" ,"Desire.RESP", "Urge.RESP", "Preoccupation.RESP")], na.rm = TRUE)
```

# Defining outliers
I'll just leave the code here to see so we know how outliers were defined.

```{r outlier participants}
# We have to exclude participant number 12 as that EEG data is not usable
full_withERP <- subset(full_withERP, Subject != 12)
## I can't use the tidy dataframe for detecting outliers. I  need the data to be organised in a different way
ERP_long <- ERP_tidy %>%
  select(., - c("difference_Cz_1":"Subject")) %>%
  mutate(High_No_Balanced_Cz = ((High_No.1.Balanced.Cz_200to290 + High_No.2.Balanced.Cz_200to290)/2),
         High_Go_Balanced_Cz = ((High_Go.1.Balanced.Cz_200to290 + High_Go.2.Balanced.Cz_200to290)/2),
         Low_No_Balanced_Cz = ((Low_No.1.Balanced.Cz_200to290 + Low_No.2.Balanced.Cz_200to290)/2),
         Low_Go_Balanced_Cz = ((Low_Go.1.Balanced.Cz_200to290 + Low_Go.2.Balanced.Cz_200to290)/2),
         High_No_HighCalGo_Cz = ((High_No.1.HighCalGo.Cz_200to290 + High_No.2.HighCalGo.Cz_200to290)/2),
         High_Go_HighCalGo_Cz = ((High_Go.1.HighCalGo.Cz_200to290 + High_Go.2.HighCalGo.Cz_200to290)/2),
         Low_No_HighCalGo_Cz = ((Low_No.1.HighCalGo.Cz_200to290 + Low_No.2.HighCalGo.Cz_200to290)/2),
         Low_Go_HighCalGo_Cz = ((Low_Go.1.HighCalGo.Cz_200to290 + Low_Go.2.HighCalGo.Cz_200to290)/2),
         High_No_LowCalGo_Cz = ((High_No.1.LowCalGo.Cz_200to290 + High_No.2.LowCalGo.Cz_200to290)/2),
         High_Go_LowCalGo_Cz = ((High_Go.1.LowCalGo.Cz_200to290 + High_Go.2.LowCalGo.Cz_200to290)/2),
         Low_No_LowCalGo_Cz = ((Low_No.1.LowCalGo.Cz_200to290 + Low_No.2.LowCalGo.Cz_200to290)/2),
         Low_Go_LowCalGo_Cz = ((Low_Go.1.LowCalGo.Cz_200to290 + Low_Go.2.LowCalGo.Cz_200to290)/2),
         High_No_Balanced_FC1 = ((High_No.1.Balanced.FC1_200to290 + High_No.2.Balanced.FC1_200to290)/2),
         High_Go_Balanced_FC1 = ((High_Go.1.Balanced.FC1_200to290 + High_Go.2.Balanced.FC1_200to290)/2),
         Low_No_Balanced_FC1 = ((Low_No.1.Balanced.FC1_200to290 + Low_No.2.Balanced.FC1_200to290)/2),
         Low_Go_Balanced_FC1 = ((Low_Go.1.Balanced.FC1_200to290 + Low_Go.2.Balanced.FC1_200to290)/2),
         High_No_HighCalGo_FC1 = ((High_No.1.HighCalGo.FC1_200to290 + High_No.2.HighCalGo.FC1_200to290)/2),
         High_Go_HighCalGo_FC1 = ((High_Go.1.HighCalGo.FC1_200to290 + High_Go.2.HighCalGo.FC1_200to290)/2),
         Low_No_HighCalGo_FC1 = ((Low_No.1.HighCalGo.FC1_200to290 + Low_No.2.HighCalGo.FC1_200to290)/2),
         Low_Go_HighCalGo_FC1 = ((Low_Go.1.HighCalGo.FC1_200to290 + Low_Go.2.HighCalGo.FC1_200to290)/2),
         High_No_LowCalGo_FC1 = ((High_No.1.LowCalGo.FC1_200to290 + High_No.2.LowCalGo.FC1_200to290)/2),
         High_Go_LowCalGo_FC1 = ((High_Go.1.LowCalGo.FC1_200to290 + High_Go.2.LowCalGo.FC1_200to290)/2),
         Low_No_LowCalGo_FC1 = ((Low_No.1.LowCalGo.FC1_200to290 + Low_No.2.LowCalGo.FC1_200to290)/2),
         Low_Go_LowCalGo_FC1 = ((Low_Go.1.LowCalGo.FC1_200to290 + Low_Go.2.LowCalGo.FC1_200to290)/2),
         High_No_Balanced_FC2 = ((High_No.1.Balanced.FC2_200to290 + High_No.2.Balanced.FC2_200to290)/2),
         High_Go_Balanced_FC2 = ((High_Go.1.Balanced.FC2_200to290 + High_Go.2.Balanced.FC2_200to290)/2),
         Low_No_Balanced_FC2 = ((Low_No.1.Balanced.FC2_200to290 + Low_No.2.Balanced.FC2_200to290)/2),
         Low_Go_Balanced_FC2 = ((Low_Go.1.Balanced.FC2_200to290 + Low_Go.2.Balanced.FC2_200to290)/2),
         High_No_HighCalGo_FC2 = ((High_No.1.HighCalGo.FC2_200to290 + High_No.2.HighCalGo.FC2_200to290)/2),
         High_Go_HighCalGo_FC2 = ((High_Go.1.HighCalGo.FC2_200to290 + High_Go.2.HighCalGo.FC2_200to290)/2),
         Low_No_HighCalGo_FC2 = ((Low_No.1.HighCalGo.FC2_200to290 + Low_No.2.HighCalGo.FC2_200to290)/2),
         Low_Go_HighCalGo_FC2 = ((Low_Go.1.HighCalGo.FC2_200to290 + Low_Go.2.HighCalGo.FC2_200to290)/2),
         High_No_LowCalGo_FC2 = ((High_No.1.LowCalGo.FC2_200to290 + High_No.2.LowCalGo.FC2_200to290)/2),
         High_Go_LowCalGo_FC2 = ((High_Go.1.LowCalGo.FC2_200to290 + High_Go.2.LowCalGo.FC2_200to290)/2),
         Low_No_LowCalGo_FC2 = ((Low_No.1.LowCalGo.FC2_200to290 + Low_No.2.LowCalGo.FC2_200to290)/2),
         Low_Go_LowCalGo_FC2 = ((Low_Go.1.LowCalGo.FC2_200to290 + Low_Go.2.LowCalGo.FC2_200to290)/2),
         High_No_Balanced_Fz = ((High_No.1.Balanced.Fz_200to290 + High_No.2.Balanced.Fz_200to290)/2),
         High_Go_Balanced_Fz = ((High_Go.1.Balanced.Fz_200to290 + High_Go.2.Balanced.Fz_200to290)/2),
         Low_No_Balanced_Fz = ((Low_No.1.Balanced.Fz_200to290 + Low_No.2.Balanced.Fz_200to290)/2),
         Low_Go_Balanced_Fz = ((Low_Go.1.Balanced.Fz_200to290 + Low_Go.2.Balanced.Fz_200to290)/2),
         High_No_HighCalGo_Fz = ((High_No.1.HighCalGo.Fz_200to290 + High_No.2.HighCalGo.Fz_200to290)/2),
         High_Go_HighCalGo_Fz = ((High_Go.1.HighCalGo.Fz_200to290 + High_Go.2.HighCalGo.Fz_200to290)/2),
         Low_No_HighCalGo_Fz = ((Low_No.1.HighCalGo.Fz_200to290 + Low_No.2.HighCalGo.Fz_200to290)/2),
         Low_Go_HighCalGo_Fz = ((Low_Go.1.HighCalGo.Fz_200to290 + Low_Go.2.HighCalGo.Fz_200to290)/2),
         High_No_LowCalGo_Fz = ((High_No.1.LowCalGo.Fz_200to290 + High_No.2.LowCalGo.Fz_200to290)/2),
         High_Go_LowCalGo_Fz = ((High_Go.1.LowCalGo.Fz_200to290 + High_Go.2.LowCalGo.Fz_200to290)/2),
         Low_No_LowCalGo_Fz = ((Low_No.1.LowCalGo.Fz_200to290 + Low_No.2.LowCalGo.Fz_200to290)/2),
         Low_Go_LowCalGo_Fz = ((Low_Go.1.LowCalGo.Fz_200to290 + Low_Go.2.LowCalGo.Fz_200to290)/2)) %>%
  select(-c(High_Go.1.Balanced.Cz_200to290:Low_No.2.LowCalGo.Fz_200to290)) %>%
  gather("Variable", "Value", High_No_Balanced_Cz:Low_Go_LowCalGo_Fz) %>%
  separate(Variable, c("HighLow", "GoNo", "Block", "Electrode"))
    
ERP_outlier_det <- ERP_long %>%
  group_by(pp, Block, Electrode) %>%
  summarise_at(vars("Value"), funs(mean)) %>%
  unite(Block_Elec, Block, Electrode, sep = ".") %>%
  spread(key = Block_Elec, value = Value)

full_withERP$ERP_outlier <- ifelse(
      ERP_outlier_det$Balanced.Cz > (mean(ERP_outlier_det$Balanced.Cz) + 3*sd(ERP_outlier_det$Balanced.Cz)) |
      ERP_outlier_det$Balanced.FC1 > (mean(ERP_outlier_det$Balanced.FC1) + 3*sd(ERP_outlier_det$Balanced.FC1)) |
      ERP_outlier_det$Balanced.FC2 > (mean(ERP_outlier_det$Balanced.FC2) + 3*sd(ERP_outlier_det$Balanced.FC2)) |
      ERP_outlier_det$Balanced.Fz > (mean(ERP_outlier_det$Balanced.Fz) + 3*sd(ERP_outlier_det$Balanced.Fz)) |
      ERP_outlier_det$HighCalGo.Cz > (mean(ERP_outlier_det$HighCalGo.Cz) + 3*sd(ERP_outlier_det$HighCalGo.Cz)) |
      ERP_outlier_det$HighCalGo.FC1 > (mean(ERP_outlier_det$HighCalGo.FC1) + 3*sd(ERP_outlier_det$HighCalGo.FC1)) |
      ERP_outlier_det$HighCalGo.FC2 > (mean(ERP_outlier_det$HighCalGo.FC2) + 3*sd(ERP_outlier_det$HighCalGo.FC2)) |
      ERP_outlier_det$HighCalGo.Fz > (mean(ERP_outlier_det$HighCalGo.Fz) + 3*sd(ERP_outlier_det$HighCalGo.Fz)) |
      ERP_outlier_det$LowCalGo.Cz > (mean(ERP_outlier_det$LowCalGo.Cz) + 3*sd(ERP_outlier_det$LowCalGo.Cz)) |
      ERP_outlier_det$LowCalGo.FC1 > (mean(ERP_outlier_det$LowCalGo.FC1) + 3*sd(ERP_outlier_det$LowCalGo.FC1)) |
      ERP_outlier_det$LowCalGo.FC2 > (mean(ERP_outlier_det$LowCalGo.FC2) + 3*sd(ERP_outlier_det$LowCalGo.FC2)) |
      ERP_outlier_det$LowCalGo.Fz > (mean(ERP_outlier_det$LowCalGo.Fz) + 3*sd(ERP_outlier_det$LowCalGo.Fz))
      , 1, 0)


# Outlier participants (defined as 3 sd above or below average)
## Food diary intake
full_withERP$Daily_intake_outlier <- 
  ifelse(full_withERP$Daily_intake > (mean(full_withERP$Daily_intake, na.rm = TRUE) + 3*sd(full_withERP$Daily_intake, na.rm = TRUE)) |
           full_withERP$Daily_intake < (mean(full_withERP$Daily_intake, na.rm = TRUE) - 3*sd(full_withERP$Daily_intake, na.rm = TRUE)),
         1, 0)
## Total lab intake
full_withERP$total_in_lab_outlier <- 
  ifelse(full_withERP$total_in_lab > (mean(full_withERP$total_in_lab) + 3*sd(full_withERP$total_in_lab)) |
           full_withERP$total_in_lab < (mean(full_withERP$total_in_lab) - 3*sd(full_withERP$total_in_lab)),
         1, 0)
## Lab intake difference between timepoints
full_withERP$lab_food_diff_outlier <- 
  ifelse(full_withERP$lab_food_diff > (mean(full_withERP$lab_food_diff) + 3*sd(full_withERP$lab_food_diff)) |
           full_withERP$lab_food_diff < (mean(full_withERP$lab_food_diff) - 3*sd(full_withERP$lab_food_diff)),
         1, 0)
## Baseline bias
full_withERP$baseline_RTbias_outlier <- 
  ifelse(full_withERP$baseline_RTbias > (mean(full_withERP$baseline_RTbias) + 3*sd(full_withERP$baseline_RTbias)) |
           full_withERP$baseline_RTbias < (mean(full_withERP$baseline_RTbias) - 3*sd(full_withERP$baseline_RTbias)),
         1, 0)
## Training bias
full_withERP$training_RTbias_outlier <- 
  ifelse(full_withERP$training_RTbias > (mean(full_withERP$training_RTbias) + 3*sd(full_withERP$training_RTbias)) |
           full_withERP$training_RTbias < (mean(full_withERP$training_RTbias) - 3*sd(full_withERP$training_RTbias)),
         1, 0)
## By average RTs within the different circles within the blocks
full_withERP$RT_outlier <- ifelse(
         full_withERP$High_Balanced_1 > (mean(full_withERP$High_Balanced_1) + 3*sd(full_withERP$High_Balanced_1))|
         full_withERP$High_Balanced_2 > (mean(full_withERP$High_Balanced_2) + 3*sd(full_withERP$High_Balanced_2))|
         full_withERP$High_Balanced_3 > (mean(full_withERP$High_Balanced_3) + 3*sd(full_withERP$High_Balanced_3))|
         full_withERP$High_Balanced_4 > (mean(full_withERP$High_Balanced_4) + 3*sd(full_withERP$High_Balanced_4))|
         full_withERP$Low_Balanced_1 > (mean(full_withERP$Low_Balanced_1) + 3*sd(full_withERP$Low_Balanced_1))|
         full_withERP$Low_Balanced_3 > (mean(full_withERP$Low_Balanced_3) + 3*sd(full_withERP$Low_Balanced_3))|
         full_withERP$Low_Balanced_3 > (mean(full_withERP$Low_Balanced_3) + 3*sd(full_withERP$Low_Balanced_3))|
         full_withERP$Low_Balanced_4 > (mean(full_withERP$Low_Balanced_4) + 3*sd(full_withERP$Low_Balanced_4))|
         full_withERP$High_HighGo_1 > (mean(full_withERP$High_HighGo_1) + 3*sd(full_withERP$High_HighGo_1))|
         full_withERP$High_HighGo_2 > (mean(full_withERP$High_HighGo_2) + 3*sd(full_withERP$High_HighGo_2))|
         full_withERP$High_HighGo_3 > (mean(full_withERP$High_HighGo_3) + 3*sd(full_withERP$High_HighGo_3))|
         full_withERP$High_HighGo_4 > (mean(full_withERP$High_HighGo_4) + 3*sd(full_withERP$High_HighGo_4))|
         full_withERP$Low_HighGo_1 > (mean(full_withERP$Low_HighGo_1) + 3*sd(full_withERP$Low_HighGo_1))|
         full_withERP$Low_HighGo_2 > (mean(full_withERP$Low_HighGo_2) + 3*sd(full_withERP$Low_HighGo_2))|
         full_withERP$Low_HighGo_3 > (mean(full_withERP$Low_HighGo_3) + 3*sd(full_withERP$Low_HighGo_3))|
         full_withERP$Low_HighGo_4 > (mean(full_withERP$Low_HighGo_4) + 3*sd(full_withERP$Low_HighGo_4))|
         full_withERP$High_LowGo_1 > (mean(full_withERP$High_LowGo_1) + 3*sd(full_withERP$High_LowGo_1))|
         full_withERP$High_LowGo_2 > (mean(full_withERP$High_LowGo_2) + 3*sd(full_withERP$High_LowGo_2))|
         full_withERP$High_LowGo_3 > (mean(full_withERP$High_LowGo_3) + 3*sd(full_withERP$High_LowGo_3))|
         full_withERP$High_LowGo_4 > (mean(full_withERP$High_LowGo_4) + 3*sd(full_withERP$High_LowGo_4))|
         full_withERP$Low_LowGo_1 > (mean(full_withERP$Low_LowGo_1) + 3*sd(full_withERP$Low_LowGo_1))|
         full_withERP$Low_LowGo_2 > (mean(full_withERP$Low_LowGo_2) + 3*sd(full_withERP$Low_LowGo_2))|
         full_withERP$Low_LowGo_3 > (mean(full_withERP$Low_LowGo_3) + 3*sd(full_withERP$Low_LowGo_3))|
         full_withERP$Low_LowGo_4 > (mean(full_withERP$Low_LowGo_4) + 3*sd(full_withERP$Low_LowGo_4)), 1, 0)

## Outlier on any of these
full_withERP$outlier <- ifelse(full_withERP$Daily_intake_outlier==1|
                             full_withERP$total_in_lab_outlier==1|
                             full_withERP$lab_food_diff_outlier==1|
                             full_withERP$baseline_RTbias_outlier==1|
                             full_withERP$training_RTbias_outlier==1|
                             full_withERP$RT_outlier==1| 
                             full_withERP$ERP_outlier==1, 1, 0)

## Outlier on any but daily intake (since there are so many to exclude)
full_withERP$outlier_notdaily <- ifelse(full_withERP$total_in_lab_outlier==1|
                             full_withERP$lab_food_diff_outlier==1|
                             full_withERP$baseline_RTbias_outlier==1|
                             full_withERP$training_RTbias_outlier==1|
                             full_withERP$RT_outlier==1|
                             full_withERP$ERP_outlier==1, 1, 0)
ERP_long$outlier <- full_withERP$outlier
ERP_long$outlier_notdaily <- full_withERP$outlier_notdaily
```

# Graphs

Just some graphs and stuff to get an idea about the behavioral data.

Errors by Subject and session (Baseline vs HighCalGo vs LowCalGo). Blue dots are ommission errors, red dots commission errors.

```{r, echo=FALSE}
error_plot <- test_dats_raw %>%
  subset(Running == "TrialListTestBalanced" | Running == "TrialListLowCalGo" | Running == "TrialListHighCalGo") %>%
  group_by(Subject, Running) %>%
  summarise_at(c("commission", "ommission"), sum, na.rm = TRUE)
error_plot_means <- error_plot %>% 
  group_by(Running) %>% 
  summarise(commission = mean(commission), ommission = mean(ommission))
ggplot(data = error_plot, aes(Running, commission)) + 
  geom_point(color = "red") +
  geom_jitter(height = .2, color = "red") +
  geom_point(data = error_plot, aes(Running, ommission), color = "blue") +
  geom_point(data = error_plot_means, stat = "identity", size = 5, alpha = .6)
```

Following are the RTs after trimming outliers by block and by part with larger dots indicating the overall means and the smaller ones the subject mean values.

```{r visualize, echo=FALSE}
### Let's visualize some of this
by_block_cycle <- full_withERP %>%
  select(Subject,
         High_Balanced_1,
         High_Balanced_2,
         High_Balanced_3,
         High_Balanced_4,
         Low_Balanced_1,
         Low_Balanced_2,
         Low_Balanced_3,
         Low_Balanced_4,
         High_HighGo_1,
         High_HighGo_2,
         High_HighGo_3,
         High_HighGo_4,
         Low_HighGo_1,
         Low_HighGo_2,
         Low_HighGo_3,
         Low_HighGo_4,
         High_LowGo_1,
         High_LowGo_2,
         High_LowGo_3,
         High_LowGo_4,
         Low_LowGo_1,
         Low_LowGo_2,
         Low_LowGo_3,
         Low_LowGo_4,
         Order) %>%
  gather(Block, RT, -c(Subject, Order)) %>%
  separate(Block, c("HighLow", "Part", "Cycle"))

by_block_cycle_means <- by_block_cycle %>%
  group_by(HighLow, Part, Cycle) %>%
  summarise(RT = mean(RT))

ggplot(by_block_cycle, aes(x = Cycle, y = RT, color = HighLow)) +
  geom_point(alpha = .3) +
  facet_wrap(aes(facets = Part)) +
  geom_point(data = by_block_cycle_means, stat = "identity", size = 5, alpha = .6) +
  ylim(250, 500)
```

Without the "outlier" participants as defined above:

```{r visualize RTs by parts, echo=FALSE}
### Let's visualize some of this
by_block_cycle_noout <- full_withERP %>%
  select(Subject,
         High_Balanced_1,
         High_Balanced_2,
         High_Balanced_3,
         High_Balanced_4,
         Low_Balanced_1,
         Low_Balanced_2,
         Low_Balanced_3,
         Low_Balanced_4,
         High_HighGo_1,
         High_HighGo_2,
         High_HighGo_3,
         High_HighGo_4,
         Low_HighGo_1,
         Low_HighGo_2,
         Low_HighGo_3,
         Low_HighGo_4,
         High_LowGo_1,
         High_LowGo_2,
         High_LowGo_3,
         High_LowGo_4,
         Low_LowGo_1,
         Low_LowGo_2,
         Low_LowGo_3,
         Low_LowGo_4,
         Order) %>%
  subset(full_withERP$outlier == 0) %>%
  gather(Block, RT, -c(Subject, Order)) %>%
  separate(Block, c("HighLow", "Part", "Cycle"))

by_block_cycle_means_noout <- by_block_cycle_noout %>%
  group_by(HighLow, Part, Cycle) %>%
  summarise(RT = mean(RT))

ggplot(by_block_cycle_noout, aes(x = Cycle, y = RT, color = HighLow)) +
  geom_point(alpha = .3) +
  facet_wrap(aes(facets = Part)) +
  geom_point(data = by_block_cycle_means_noout, stat = "identity", size = 5, alpha = .6) +
  ylim(250, 500)
  
```

# Hypothesis 1: N2 by food image type and Go vs No-Go

So here's the test for the first hypothesis:

```{r}
# Let's test our first hypothesis about the interaction between stimulus type and trial type in the balanced block
fit_ERP_baseline <- lmerTest::lmer(Value ~ HighLow*GoNo + (1|pp),
                                      data=subset(ERP_long, Block == "Balanced"))
anova_ERP_baseline <- anova(fit_ERP_baseline)
anova_ERP_baseline
summary(fit_ERP_baseline)

ggplot(ERP_long, aes(x = HighLow, y = Value, color = GoNo)) + geom_boxplot()

# So we have a significant effect of Go/No-Go but no interaction. 
subset(ERP_long, Block == "Balanced") %>% group_by(HighLow, GoNo) %>% summarise_at("Value", mean)
# Looks like Low-calorie No-Go trials provoke the largest N2
```

## Without different outlier criteria:

```{r}
# Without any outliers
fit_ERP_baseline <- lmerTest::lmer(Value ~ HighLow*GoNo + (1|pp),
                                      data=subset(ERP_long, (Block == "Balanced" & outlier == "0")))
anova_ERP_baseline <- anova(fit_ERP_baseline)
anova_ERP_baseline
summary(fit_ERP_baseline)

ggplot(subset(ERP_long, (Block == "Balanced" & outlier == "0")), aes(x = HighLow, y = Value, color = GoNo)) + geom_boxplot()

# So we have a significant effect of Go/No-Go and of High vs Low but no interaction. 
subset(ERP_long, (Block == "Balanced" & outlier == "0")) %>% group_by(HighLow, GoNo) %>% summarise_at("Value", mean)
# Looks like Low-calorie No-Go trials provoke the largest N2



# Without outliers but with the diary outliers
fit_ERP_baseline <- lmerTest::lmer(Value ~ HighLow*GoNo + (1|pp),
                                      data=subset(ERP_long, (Block == "Balanced" & outlier_notdaily == "0")))
anova_ERP_baseline <- anova(fit_ERP_baseline)
anova_ERP_baseline
summary(fit_ERP_baseline)

ggplot(ERP_long, aes(x = HighLow, y = Value, color = GoNo)) + geom_boxplot()

# So we have a significant effect of Go/No-Go but no other effects
subset(ERP_long, (Block == "Balanced" & outlier_notdaily == "0")) %>% group_by(HighLow, GoNo) %>% summarise_at("Value", mean)
# Looks like Low-calorie No-Go trials provoke the largest N2
```

Regardless of outliers we always find an effect of Go vs No with NoGo trials producing larger N2s (not surprisingly). Whether or not the main effect of food category becomes significant depends on which outliers we remove (not good!). However, the predicted interaction between Go/NoGo and food type is _never_ significant.

# Hypothesis 2: Baseline RT differences

Here's the t-test for baseline differences between High- and Low-calorie foods.

```{r}
# Let's do some inferential statistics
## This is only for the BASELINE block
### paired t-test to compare the different kinds of stimulus
dat_t_test <- NA
dat_t_test$High_Balanced <- (as.numeric(full_withERP$High_Balanced_1) + 
                               as.numeric(full_withERP$High_Balanced_2) +
                               as.numeric(full_withERP$High_Balanced_3) +
                               as.numeric(full_withERP$High_Balanced_4))/4
dat_t_test$Low_Balanced <- (as.numeric(full_withERP$Low_Balanced_1) + 
                              as.numeric(full_withERP$Low_Balanced_2) +
                              as.numeric(full_withERP$Low_Balanced_3) +
                              as.numeric(full_withERP$Low_Balanced_4))/4

t.test(dat_t_test$High_Balanced, dat_t_test$Low_Balanced, paired = TRUE, alternative = "less")
```

There's no difference between the types of food images.  

## Without the "outlier" participants as defined above:

```{r}
# Let's do some inferential statistics
## This is only for the BASELINE block
### paired t-test to compare the different kinds of stimulus
dat_t_test_noout <- NA
dat_t_test_noout$High_Balanced <- subset((as.numeric(full_withERP$High_Balanced_1) + 
                               as.numeric(full_withERP$High_Balanced_2) +
                               as.numeric(full_withERP$High_Balanced_3) +
                               as.numeric(full_withERP$High_Balanced_4)), full_withERP$outlier == 0)/4
dat_t_test_noout$Low_Balanced <- subset((as.numeric(full_withERP$Low_Balanced_1) + 
                              as.numeric(full_withERP$Low_Balanced_2) +
                              as.numeric(full_withERP$Low_Balanced_3) +
                              as.numeric(full_withERP$Low_Balanced_4)), full_withERP$outlier == 0)/4

t.test(dat_t_test_noout$High_Balanced, dat_t_test_noout$Low_Balanced, 
       paired = TRUE, alternative = "less")

## And without the outliers defined without diary intake
dat_t_test_noout2 <- NA
dat_t_test_noout2$High_Balanced <- subset((as.numeric(full_withERP$High_Balanced_1) + 
                               as.numeric(full_withERP$High_Balanced_2) +
                               as.numeric(full_withERP$High_Balanced_3) +
                               as.numeric(full_withERP$High_Balanced_4)), full_withERP$outlier_notdaily == 0)/4
dat_t_test_noout2$Low_Balanced <- subset((as.numeric(full_withERP$Low_Balanced_1) + 
                              as.numeric(full_withERP$Low_Balanced_2) +
                              as.numeric(full_withERP$Low_Balanced_3) +
                              as.numeric(full_withERP$Low_Balanced_4)), full_withERP$outlier_notdaily == 0)/4

t.test(dat_t_test_noout2$High_Balanced, dat_t_test_noout2$Low_Balanced, 
       paired = TRUE, alternative = "less")
```

### Add-on: Food type and cycles

Now we're looking at reaction time differences between High and Low calorie foods and between Cycles.

```{r}
## Testing reaction time differences between High and Low calorie foods and between Cycles
### Getting the data into right format
regression_dat <- full_withERP %>% 
  gather("Trial_Part_Cycle", "RT", 15:38) %>%
  separate(Trial_Part_Cycle, into = c("Trial", "Part", "Cycle"))

fit_baseline_blocks <- lmerTest::lmer(RT ~ Trial*Cycle + (1|Subject),
            data=subset(regression_dat, Part == "Balanced"))

anova_baseline_blocks <- anova(fit_baseline_blocks)
anova_baseline_blocks
summary(fit_baseline_blocks, correlation = FALSE)
## Significant effect of Cycle - contrasts: Participants are faster in Cycle 4 than Cycle 1. 
## No effect of food type and/or interaction.
```

So we see that Cycle 4 is faster than Cycle 1.

And a graph to go with it:

```{r, echo = FALSE}
## Here it is in a graph:
Running_Cycle_balanced <- subset(test_dats, (Primetype == "HighGo" & Running == "TrialListTestBalanced")|(Primetype == "LowGo" & Running == "TrialListTestBalanced")) %>%
  group_by(Cycle, Running, Primetype) %>% 
  summarise(Stim.RT = mean(Stim.RT))

ggplot(data = Running_Cycle_balanced, aes(x = Cycle, y = Stim.RT , color = Primetype)) +
  geom_point(size = 2)
```

#### Without outlier participants:

```{r}
### Testing reaction time differences between High and Low calorie foods and between Cycles
fit_baseline_blocks_noout <- lmerTest::lmer(RT ~ Trial*Cycle + (1|Subject),
            data=subset(regression_dat, Part == "Balanced" & outlier == "0"))

anova_baseline_blocks_noout <- anova(fit_baseline_blocks_noout)
anova_baseline_blocks_noout
summary(fit_baseline_blocks_noout, correlation = FALSE)
## Significant effect of Cycle - contrasts: Participants are faster in Cycle 4 than Cycle 1. 
## No effect of food type and/or interaction.
```


### And then the bias blocks.

```{r}
## Now for the bias blocks
## Comparing reaction times for dominant Go trials from the respective blocks 
## and between Cycles within the respective blocks 

fit_bias_blocks <- lmerTest::lmer(RT ~ Trial*Cycle + (1|Subject),
            data=subset(regression_dat, 
                        (Trial == "High" & Part == "HighGo")|( Trial == "Low" & Part == "LowGo")))
anova_bias_blocks <- anova(fit_bias_blocks)
anova_bias_blocks
summary(fit_bias_blocks, correlation = FALSE)
## There are no significant effects whatsoever

### Visualize much?!
Running_Cycle_bias <- subset(test_dats, 
                             (Primetype == "HighGo" & Running == "TrialListHighCalGo")|(Primetype == "LowGo" & Running == "TrialListLowCalGo")) %>%
  group_by(Cycle, Running, Primetype) %>% 
  summarise(Stim.RT = mean(Stim.RT))

ggplot(data = Running_Cycle_bias, aes(x = Cycle, y = Stim.RT , color = Running, shape = Primetype)) +
  geom_point(size = 2)
```

No significant effects of cycles, food stimuli, or their interaction.

#### And without outlier participants:

```{r}
## Now for the bias blocks
## Comparing reaction times for dominant Go trials from the respective blocks 
## and between Cycles within the respective blocks 

fit_bias_blocks_noout <- lmerTest::lmer(RT ~ Trial*Cycle + (1|Subject),
            data=subset(regression_dat, 
                        (Trial == "High" & Part == "HighGo")|( Trial == "Low" & Part == "LowGo") & 
                          outlier == 0))
anova_bias_blocks_noout <- anova(fit_bias_blocks_noout)
anova_bias_blocks_noout
summary(fit_bias_blocks_noout, correlation = FALSE)
## There are no significant effects whatsoever
```

No significant effects for Cycle in the bias blocks.

# Hypothesis 3: Predicting food intake with N2 differences

To test hypothesis 3: predicting food intake with difference scores: (HighCalorie-NoGo - HighCalorieGo) - (LowCalorie-NoGo - LowCalorieGo).
I always have the model including all participants and then when removing outliers.

```{r}
# For Cz
## Regression for diary intake
summary(lm(Daily_intake ~ BaselineDiff_Cz + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(Daily_intake ~ BaselineDiff_Cz + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
# No effect

## And for lab food intake
summary(lm(total_in_lab ~ BaselineDiff_Cz + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(total_in_lab ~ BaselineDiff_Cz + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
summary(lm(total_in_lab ~ BaselineDiff_Cz + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier_notdaily == "0")))
# No effect

# For FC1
## Regression for diary intake
summary(lm(Daily_intake ~ BaselineDiff_FC1 + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(Daily_intake ~ BaselineDiff_FC1 + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
# No effect

## And for lab food intake
summary(lm(total_in_lab ~ BaselineDiff_FC1 + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(total_in_lab ~ BaselineDiff_FC1 + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
summary(lm(total_in_lab ~ BaselineDiff_FC1 + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier_notdaily == "0")))
# No effect

# For FC2
## Regression for diary intake
summary(lm(Daily_intake ~ BaselineDiff_FC2 + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(Daily_intake ~ BaselineDiff_FC2 + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
# No effect

## And for lab food intake
summary(lm(total_in_lab ~ BaselineDiff_FC2 + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(total_in_lab ~ BaselineDiff_FC2 + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
summary(lm(total_in_lab ~ BaselineDiff_FC2 + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier_notdaily == "0")))
# No effect

# For Fz
## Regression for diary intake
summary(lm(Daily_intake ~ BaselineDiff_Fz + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(Daily_intake ~ BaselineDiff_Fz + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
# No effect

## And for lab food intake
summary(lm(total_in_lab ~ BaselineDiff_Fz + as.numeric(Age) + Sex + BMI + overall_hunger, data = full_withERP))
summary(lm(total_in_lab ~ BaselineDiff_Fz + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier == "0")))
summary(lm(total_in_lab ~ BaselineDiff_Fz + as.numeric(Age) + Sex + BMI + overall_hunger, data = subset(full_withERP, outlier_notdaily == "0")))
# No effect
```

None of the electrode sites show an effect (whether we include outliers or not), so we can confidently conclude that N2-baseline bias was not predictive of food intake inside and outside the laboratory.

# Hypothesis 4: Food intake outcomes.

We see _higher_ food consumption after the _Low-Calorie-Go_ condition.

```{r}
# Let's look at some of the food intake outcomes
## Lab intake
full_withERP %>% summarise_at(vars(after_High_Cal_Go, after_Low_Cal_Go), mean)
### Descriptively, participants ate MORE after Low_Cal_Go (against the hypothesis!)
### Let's run a t-test on that
t.test(full_withERP$after_High_Cal_Go, full_withERP$after_Low_Cal_Go, paired = TRUE, alternative = "less")
## No significant difference between consumption after HighCalGo vs LowCalGo

## Lab intake by timepoint
full_withERP %>% summarise_at(vars(consumed_T1, consumed_T2), mean)
t.test(full_withERP$consumed_T1, full_withERP$consumed_T2, paired = TRUE, alternative = "greater") 
#No significant differences between timepoints
```

To give an idea about how much participants ate at the two time points:

```{r}
lab_intake_time <- select(full_withERP,
                     Subject,
                     consumed_T1, 
                     consumed_T2) %>%
  gather("timepoint", "amount", -Subject)
ggplot(lab_intake_time, aes(timepoint, amount, group = Subject, color = Subject)) + 
  geom_point() +
  geom_line(stat = "identity")

lab_intake_training <- select(full_withERP,
                          Subject,
                          after_High_Cal_Go, 
                          after_Low_Cal_Go) %>%
  gather("training", "amount", -Subject)
ggplot(lab_intake_training, aes(training, amount, group = Subject, color = Subject)) + 
  geom_point() +
  geom_line(stat = "identity")
```

## Without the outlier participants

```{r}
# Let's look at some of the food intake outcomes
## Lab intake
full_withERP %>% 
  subset(outlier == 0) %>%
  summarise_at(vars(after_High_Cal_Go, after_Low_Cal_Go), mean)
### Descriptively, participants ate MORE after Low_Cal_Go (against the hypothesis!)
### Let's run a t-test on that
t.test(subset(full_withERP$after_High_Cal_Go, full_withERP$outlier == 0), 
       subset(full_withERP$after_Low_Cal_Go, full_withERP$outlier == 0), 
       paired = TRUE, alternative = "less")
### A one-sided t-test does not show a signigicant difference

## Lab intake by timepoint
full_withERP %>% 
  subset(outlier == 0) %>%
  summarise_at(vars(consumed_T1, consumed_T2), mean)
t.test(subset(full_withERP$consumed_T1, full_withERP$outlier == 0), subset(full_withERP$consumed_T2, full_withERP$outlier == 0),
       paired = TRUE, alternative = "greater") 
#No significant differences between timepoints
```

And again, some visualization:

```{r}
lab_intake_time <- full_withERP %>% 
  subset(outlier == 0) %>% 
  select(Subject,
         consumed_T1, 
         consumed_T2) %>%
  gather("timepoint", "amount", -Subject)

ggplot(lab_intake_time, aes(timepoint, amount, group = Subject, color = Subject)) + 
  geom_point() +
  geom_line(stat = "identity")

lab_intake_training <- full_withERP %>% 
  subset(outlier == 0) %>% 
  select(Subject,
         consumed_T1, 
         consumed_T2) %>%
  gather("training", "amount", -Subject)

ggplot(lab_intake_training, aes(training, amount, group = Subject, color = Subject)) + 
  geom_point() +
  geom_line(stat = "identity")
```


# Hypothesis 5: Training effects on N2

The hypothesis is that N2 becomes more pronounced with training, i.e. the values are more extreme in Cycle 2 than Cycle 1 and that this change is more pronounced for high calorie food (i.e. an interaction between differences with type of food).

```{r}
ERP_anova_change <- ERP_tidy %>%
  select(pp, LowCalGo_DiffCz_1:HighCalGo_DiffFz_2) %>%
  gather("Block.electrode.Cycle", "difference.score", LowCalGo_DiffCz_1:HighCalGo_DiffFz_2) %>%
  separate(col = Block.electrode.Cycle, into = c("Block", "Electrode", "Cycle"), sep = "_")

fit_ERP_change <- lmerTest::lmer(difference.score ~ Block*Cycle + (1|pp), data=ERP_anova_change)
anova_ERP_change <- anova(fit_ERP_change)
anova_ERP_change
summary(fit_ERP_change)
## We have main effects for Block and Cycle (with later cycle showing stronger N2s) but no interaction effect.

ggplot(ERP_anova_change, aes(Block, difference.score, color = Cycle)) + geom_boxplot()
ERP_anova_change %>% group_by(Block, Cycle) %>% summarise_at(., "difference.score", funs(mean, median, sd))
```

So we _do_ see the expected main effect of Cycle, also a main effect of food type (with _low-calorie food_ leading to _larger_ N2) but _no_ interaction.


## Without outliers

Without all kinds of outliers:

```{r}
ERP_anova_change <- full_withERP %>%
  select(pp, c(LowCalGo_DiffCz_1:HighCalGo_DiffFz_2, outlier, outlier_notdaily)) %>%
  gather("Block.electrode.Cycle", "difference.score", LowCalGo_DiffCz_1:HighCalGo_DiffFz_2) %>%
  separate(col = Block.electrode.Cycle, into = c("Block", "Electrode", "Cycle"), sep = "_")

fit_ERP_change <- lmerTest::lmer(difference.score ~ Block*Cycle + (1|pp), data=subset(ERP_anova_change, outlier == 0))
anova_ERP_change <- anova(fit_ERP_change)
anova_ERP_change
summary(fit_ERP_change)
## We have main effects for Block and Cycle (with later cycle showing stronger N2s) but no interaction effect.

ggplot(subset(ERP_anova_change, outlier == 0), aes(Block, difference.score, color = Cycle)) + geom_boxplot()
subset(ERP_anova_change, outlier == 0) %>% group_by(Block, Cycle) %>% summarise_at(., "difference.score", funs(mean, sd))
```

And admitting the outlier criterion not including diary intake:

```{r}
ERP_anova_change <- full_withERP %>%
  select(pp, c(LowCalGo_DiffCz_1:HighCalGo_DiffFz_2, outlier, outlier_notdaily)) %>%
  gather("Block.electrode.Cycle", "difference.score", LowCalGo_DiffCz_1:HighCalGo_DiffFz_2) %>%
  separate(col = Block.electrode.Cycle, into = c("Block", "Electrode", "Cycle"), sep = "_")

fit_ERP_change <- lmerTest::lmer(difference.score ~ Block*Cycle + (1|pp), data=subset(ERP_anova_change, outlier_notdaily == 0))
anova_ERP_change <- anova(fit_ERP_change)
anova_ERP_change
summary(fit_ERP_change)
## We have main effects for Block and Cycle (with later cycle showing stronger N2s) but no interaction effect.

ggplot(subset(ERP_anova_change, outlier_notdaily == 0), aes(Block, difference.score, color = Cycle)) + geom_boxplot()
subset(ERP_anova_change, outlier_notdaily == 0) %>% group_by(Block, Cycle) %>% summarise_at(., "difference.score", funs(mean, sd))
```

# An add-on to Hypothesis 3: RT-bias and food intake

## Baseline RT bias

Using baseline RT-bias to predict food intake:

```{r}
# Diary data
summary(full_withERP$Daily_intake) 
# So the average reported intake is 8360 kJ with a max of 29521 kJ (7055 kcal) 
# and a min of 2380 kJ (569 kcal)

ggplot(full_withERP, aes(Subject, Daily_intake)) + 
  geom_point()

## Let's do a regression with High-Cal-Go minus Low-Cal-Go at baseline (baseline bias) 
## predicting food intake

summary(lm(Daily_intake ~ baseline_RTbias + as.numeric(Age) + Sex + BMI, data = full_withERP))
## And for lab food intake
summary(lm(total_in_lab ~ baseline_RTbias + as.numeric(Age) + Sex + BMI, data = full_withERP))
### Both regression coefficients are not significant
```

So here we see that the "baseline bias" (i.e. reaction times to high-calorie items minus reaction times to low-calorie items) is _not_ related to intake as reported in the diary or in the lab.

### Without outlier participants

```{r}
# Diary data
summary(subset(full_withERP$Daily_intake, full_withERP$outlier == 0)) 
# So the average reported intake is 7891 kJ with a max of 17270 kJ and a min of 3369 kJ
ggplot(subset(full_withERP, outlier==0), aes(Subject, Daily_intake)) + 
  geom_point()

## Let's do a regression with High-Cal-Go minus Low-Cal-Go at baseline (baseline bias) 
## predicting food intake

summary(lm(Daily_intake ~ baseline_RTbias + as.numeric(Age) + Sex + BMI, 
           data = subset(full_withERP, outlier==0)))
## And for lab food intake
summary(lm(total_in_lab ~ baseline_RTbias + as.numeric(Age) + Sex + BMI, 
           data = subset(full_withERP, outlier==0)))
### Both regression coefficients are not significant
```

So there is still no association between baseline RT bias and food intake.

## Training RT bias

Now we'll also look at bias in the training blocks, i.e. reaction times to dominant Go-trials in the respective blocks.

```{r}
# Regression
summary(lm(Daily_intake ~ training_RTbias + as.numeric(Age) + Sex + BMI, data = full_withERP))
# the training bias is predictive of diary intake! (p = .045, though)

## And for lab food intake
summary(lm(total_in_lab ~ training_RTbias + as.numeric(Age) + Sex + BMI, data = full_withERP))
### Not significant
```

So training bias is predictive of food intake as reported in the food diary (at _p_=.045, though) but not of in-lab fod intake.

### Without outlier participants

```{r}
# Regression
summary(lm(Daily_intake ~ training_RTbias + as.numeric(Age) + Sex + BMI, 
           data = subset(full_withERP, outlier==0)))
# the training bias is not predictive of diary intake!

## And for lab food intake
summary(lm(total_in_lab ~ training_RTbias + as.numeric(Age) + Sex + BMI, 
           data = subset(full_withERP, outlier==0)))
### Not significant 

ggplot(data = subset(full_withERP, outlier==0), 
       aes(x = baseline_RTbias, y = total_in_lab)) +
         geom_point() +
         geom_smooth(method = "lm")
```

But no significant relation left after removing outliers.
